---
title: "Untitled"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

## Install packages
```{r}

if (!requireNamespace("BiocManager", quietly = TRUE))
    install.packages("BiocManager")

BiocManager::install("edgeR")
```

## Libraries
```{r}
library(edgeR)
library(Seurat)
library(cowplot)
library(patchwork)
library(tidyverse)
library(ggpubr)
library(ggplot2)
```

---------------------------------------------------------------------------------------------------------------------------------------

#dataload
```{r}
data_dirK ="//atlas/users/sarah.nickels/jun/K7_filtered_feature_bc_matrix"
list.files(data_dirK)
MglK <- Read10X(data.dir = data_dirK)
MglK7 = CreateSeuratObject(counts = MglK)


data_dir1 ="//atlas/users/sarah.nickels/jun/M69_filtered_feature_bc_matrix"
list.files(data_dir1)
Mgl1 <- Read10X(data.dir = data_dir1)
Mgl163 = CreateSeuratObject(counts = Mgl1)

data_dirN ="//atlas/users/sarah.nickels/jun/wildtype_filtered_feature_bc_matrix"
list.files(data_dirN)
NMgl <- Read10X(data.dir = data_dirN)
NoMgl = CreateSeuratObject(counts = NMgl)

```

```{r}

NoMgl[["percent.ribo"]] <- PercentageFeatureSet(NoMgl, pattern = "^RP[SL]")
Mgl163[["percent.ribo"]] <- PercentageFeatureSet(Mgl163, pattern = "^RP[SL]")
MglK7[["percent.ribo"]] <- PercentageFeatureSet(MglK7, pattern = "^RP[SL]")


rib1=VlnPlot(NoMgl, features = c("nFeature_RNA", "nCount_RNA",  "percent.ribo"), ncol = 4)
rib2=VlnPlot(Mgl163, features = c("nFeature_RNA", "nCount_RNA",  "percent.ribo"), ncol = 4)
rib3=VlnPlot(MglK7, features = c("nFeature_RNA", "nCount_RNA", "percent.ribo"), ncol = 4)

pdf("rib.pdf", width =7, height=5)
print(rib1)
print(rib2)
print(rib3)
dev.off()

```

#quality controls - idependent

```{r}
NoMgl[["percent.mt"]] <- PercentageFeatureSet(NoMgl, pattern = "^MT-")

p0=VlnPlot(NoMgl, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
plot1 <- FeatureScatter(NoMgl, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot2 <- FeatureScatter(NoMgl, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot1 + plot2

NoMgl <- subset(NoMgl, subset = nFeature_RNA > 100 & nFeature_RNA < 5000 & percent.mt < 25)

p=VlnPlot(NoMgl, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
plot3 <- FeatureScatter(NoMgl, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot4 <- FeatureScatter(NoMgl, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot3 + plot4

pdf("1.pdf", width =7, height=5)
print(plot1)
print(plot2)
print(plot3)
print(plot4)
print(p0)
print(p)
dev.off()

#----------

MglK7[["percent.mt"]] <- PercentageFeatureSet(MglK7, pattern = "^MT-")

VlnPlot(MglK7, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
plot1 <- FeatureScatter(MglK7, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot2 <- FeatureScatter(MglK7, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot1 + plot2

MglK7 <- subset(MglK7, subset = nFeature_RNA > 100 & nFeature_RNA < 5000 & percent.mt < 25)

VlnPlot(MglK7, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
plot3 <- FeatureScatter(MglK7, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot4 <- FeatureScatter(MglK7, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot3 + plot4

pdf("2.pdf", width =7, height=5)
print(plot1)
print(plot2)
print(plot3)
print(plot4)
print(p0)
print(p)
dev.off()
#-----------
  
Mgl163[["percent.mt"]] <- PercentageFeatureSet(Mgl163, pattern = "^MT-")
VlnPlot(Mgl163, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)

plot1 <- FeatureScatter(Mgl163, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot2 <- FeatureScatter(Mgl163, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot1 + plot2

Mgl163 <- subset(Mgl163, subset = nFeature_RNA > 100 & nFeature_RNA < 6000 & percent.mt < 25)

VlnPlot(Mgl163, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3)
plot3 <- FeatureScatter(Mgl163, feature1 = "nCount_RNA", feature2 = "percent.mt")
plot4 <- FeatureScatter(Mgl163, feature1 = "nCount_RNA", feature2 = "nFeature_RNA")
plot3+plot4


pdf("3.pdf", width =7, height=5)
print(plot1)
print(plot2)
print(plot3)
print(plot4)
print(p0)
print(p)
dev.off()
```

#Combine 3 objects

```{r}
Comb3SNQC<- merge(x = NoMgl, y = list(Mgl163, MglK7), add.cell.ids = c("NoMgl","Mgl163","MglK7"), merge.data = TRUE, project = "dataComb")
Comb3SNQC
```
# add column Model
```{r}

head(Comb3SNQC@meta.data, 5)


groups <- sample(c(""), size = 33538, replace = TRUE)
names(groups) <- colnames(Comb3SNQC)
Comb3SNQC <- AddMetaData(object = Comb3SNQC, metadata = groups, col.name = "Model")
head(Comb3SNQC@meta.data, 5)


No_Mgl3<- grep("NoMgl", colnames(Comb3SNQC)) #1-1364
Mgl_K73 <- grep("MglK7", colnames(Comb3SNQC)) #2756-3560
Mgl_1633 <- grep("Mgl163", colnames(Comb3SNQC)) #1365- 2755

Comb3SNQC$Model[1:1364] <- "No_Mgl"
Comb3SNQC$Model[2756:3560] <- "Mgl_K7"
Comb3SNQC$Model[1365:2755] <- "Mgl_163"

head(Comb3SNQC@meta.data, 5)

```

#Log normalize 
```{r}

VlnPlot(Comb3SNQC, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3, split.by = "Model")

Comb3SNQC <- NormalizeData(Comb3SNQC, assay = NULL, normalization.method = "LogNormalize", scale.factor = 10000)


all=VlnPlot(Comb3SNQC, features = c("nFeature_RNA", "nCount_RNA", "percent.mt", "percent.ribo"), ncol = 4, split.by = "Model")


pdf("4.pdf", width =7, height=5)
print(all)
dev.off()

```

#Identification of highly variable features (feature selection)
```{r}

Comb3SNQC <- FindVariableFeatures(Comb3SNQC, selection.method = "vst", nfeatures = 2000)
top10c <- head(VariableFeatures(Comb3SNQC), 10)
plot7 <- VariableFeaturePlot(Comb3SNQC)
plot8 <- LabelPoints(plot = plot7, points = top10c, repel = TRUE)
plot8

head(Comb3SNQC@meta.data, 5)

pdf("5.pdf", width =7, height=5)
print(plot8)
dev.off()

```

#shift genes - vars.to.regress = "percent.mt" removes unwantes sources of variation due to mito ontamination or all genes

```{r}


all.genes <- rownames(Comb3SNQC)
Comb3SNQC<- ScaleData(Comb3SNQC, features = all.genes)

VlnPlot(Comb3SNQC, features = c("nFeature_RNA", "nCount_RNA", "percent.mt"), ncol = 3, split.by = "Model")

```

#Perform linear dimensional reduction for PCA
```{r}

Comb3SNQC <- RunPCA(Comb3SNQC, features = VariableFeatures(object = Comb3SNQC))
print(Comb3SNQC[["pca"]], dims = 1:5, nfeatures = 5)

pc=VizDimLoadings(Comb3SNQC, dims = 1:2, reduction = "pca")
p2=DimPlot(Comb3SNQC, reduction = "pca")
p3=DimHeatmap(Comb3SNQC, dims = 1, cells = 500, balanced = TRUE)
p4=DimHeatmap(Comb3SNQC, dims = 1:5, cells = 500, balanced = TRUE)


pdf("6.pdf", width =7, height=5)
print(pc)
print(p2)
print(p3)
print(p4)
dev.off()
```

#Determine dimensionality

```{r}

p5=DimHeatmap(Comb3SNQC, dims = 1:20, cells = 500, balanced = TRUE)

Comb3SNQC <- JackStraw(Comb3SNQC, num.replicate = 100)
Comb3SNQC <- ScoreJackStraw(Comb3SNQC, dims = 1:20)
j=JackStrawPlot(Comb3SNQC, dims = 1:20)

el=ElbowPlot(Comb3SNQC)


pdf("7.pdf", width =7, height=5)
print(p5)
print(j)
print(el)
dev.off()
```

-----------------------------------------------------------------------------------------------------------

#Cluster the cells
```{r}

Comb3SNQC <- FindNeighbors(Comb3SNQC, dims = 1:20)
Comb3SNQC <- FindClusters(Comb3SNQC, resolution = 0.5)

head(Idents(Comb3SNQC), 5)

```


#Run non-linear dimensional reduction
```{r}

Idents(Comb3SNQC)   = "seurat_clusters"

Comb3SNQC <- RunUMAP(Comb3SNQC, dims = 1:20)

DimPlot(Comb3SNQC, reduction = "umap")
DimPlot(Comb3SNQC, reduction = "umap", group.by="Model")

DimPlot(Comb3SNQC, reduction = "umap", split.by = "Model")

levels(Comb3SNQC)   



```


#cluster markers
```{r}

Comb3SNQC.markers <- FindAllMarkers(Comb3SNQC, only.pos = TRUE, min.pct = 0.25, logfc.threshold = 0.25)
Comb3SNQC.markers %>% group_by(cluster) %>% top_n(n = 2, wt = avg_logFC)

write.csv(Comb3SNQC.markers, file = "ClusterMarkers_Comb3SNQC(dim20)res.csv")
#write.csv(Comb3SNQC.markers, file = "ClusterMarkers_Comb3SNQC(dim20).csv")

#write.csv(Comb3SNQC.markers, file = "ClusterMarkers_Comb3SNQC_SCT2.csv")

```

# not needed
#add cell names using La Mano
```{r}


a=read.csv("//atlas/users/sarah.nickels/jun/exp.csv", header = T, row.names = 1)
fix(a)

seur=read.csv("//atlas/users/sarah.nickels/jun/Comb3SNQC_Mano_04.csv", header = T, row.names= 1)
#seur=read.csv("//atlas/users/sarah.nickels/jun/Comb3SNQC_Mano_SCT.csv", header = T, row.names= 1)

fix(seur)



BasalGenes = a[a$Basal == 1,]
#fix(BasalGenes)
BG=as.vector(rownames(BasalGenes))

#fix(BG)
#write.csv(BasalGenes$Genes, file = "Basal.csv")

for (i in 1:4183) {
if ((row.names(seur[i,]) %in% BG) == TRUE) {seur$Basal[i] <- "Basal" }}
#seur$Basal[5]
#t=row.names(seur[1,])
#k=row.names(seur[,]) %in% BG 
#row.names(seur[5,]) %in% BG == T

# do this for all

hEndoGenes = a[a$hEndo == 1,]
hEndo= as.vector(rownames(hEndoGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hEndo) == TRUE) {seur$hEndo[i] <- "hEndo" }}


hPericGenes = a[a$hPeric == 1,]
Peri=as.vector(rownames(hPericGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% Peri) == TRUE) {seur$hPeric[i] <- "hPeric" }}

hMglGenes = a[a$hMgl == 1,]
hMg1=as.vector(rownames(hMglGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hMg1) == TRUE) {seur$hMgl[i] <- "hMgl" }}


hOPCGenes = a[a$hOPC == 1,]
hOPC=as.vector(rownames(hOPCGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hOPC) == TRUE) {seur$hOPC[i] <- "hOPC" }}

hRgl2cGenes = a[a$hRgl2c == 1,]
hRgl2c=as.vector(rownames(hRgl2cGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hRgl2c) == TRUE) {seur$hRgl2c[i] <- "hRgl2c" }}


hRgl2bGenes = a[a$hRgl2b == 1,]
hRgl2b=as.vector(rownames(hRgl2bGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hRgl2b) == TRUE) {seur$hRgl2b[i] <- "hRgl2b" }}


hRgl2aGenes = a[a$hRgl2a == 1,]
hRgl2a=as.vector(rownames(hRgl2aGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in%hRgl2a) == TRUE) {seur$hRgl2a[i] <- "hRgl2a" }}

hRgl3Genes = a[a$hRgl3 == 1,]
hRgl3=as.vector(rownames(hRgl3Genes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hRgl3) == TRUE) {seur$hRgl3[i] <- "hRgl3" }}

hRgl1Genes = a[a$hRgl1 == 1,]
hRgl1=as.vector(rownames(hRgl1Genes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hRgl1) == TRUE) {seur$hRgl1[i] <- "hRgl1" }}

hProgMGenes = a[a$hProgM == 1,]
hProgM=as.vector(rownames(hProgMGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hProgM) == TRUE) {seur$hProgM[i] <- "hProgM" }}

hProgBPGenes = a[a$hProgBP == 1,]
hProgBP=as.vector(rownames(hProgBPGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hProgBP) == TRUE) {seur$hProgBP[i] <- "hProgBP" }}


hProgFPLGenes = a[a$hProgFPL == 1,]
hProgFPL=as.vector(rownames(hProgFPLGenes))
for (i in 1:5154) {
if ((row.names(seur[i,]) %in% hProgFPL) == TRUE) {seur$hProgFPL[i] <- "hProgFPL" }}


hProgFPMGenes = a[a$hProgFPM == 1,]
hProgFPM=as.vector(rownames(hProgFPMGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hProgFPM) == TRUE) {seur$hProgFPM[i] <- "hProgFPM" }}


hNProgGenes = a[a$hNProg == 1,]
hNProg=as.vector(rownames(hNProgGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hNProg) == TRUE) {seur$hNProg[i] <- "hNProg" }}

hNbMGenes = a[a$hNbM == 1,]
hNbM=as.vector(rownames(hNbMGenes ))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hNbM) == TRUE) {seur$hNbM[i] <- "hNbM" }}

hNbML1Genes = a[a$hNbML1 == 1,]
hNbML1=as.vector(rownames(hNbML1Genes))
for (i in 1:5154) {
if ((row.names(seur[i,]) %in% hNbML1) == TRUE) {seur$hNbML1[i] <- "hNbML1" }}


hRNGenes = a[a$hRN == 1,]
hRN=as.vector(rownames(hRNGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hRN) == TRUE) {seur$hRN[i] <- "hRN" }}

hNbML5Genes = a[a$hNbML5 == 1,]
hNbML5=as.vector(rownames(hNbML5Genes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hNbML5) == TRUE) {seur$hNbML5[i] <- "hNbML5" }}


hDA0Genes = a[a$hDA0 == 1,]
hDA0=as.vector(rownames(hDA0Genes))
for (i in 1:5154) {
if ((row.names(seur[i,]) %in% hDA0) == TRUE) {seur$hDA0[i] <- "hDA0" }}

hDA1Genes = a[a$hDA1 == 1,]
hDA1=as.vector(rownames(hDA1Genes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hDA1) == TRUE) {seur$hDA1[i] <- "hDA1" }}

hDA2Genes = a[a$hDA2 == 1,]
hDA2=as.vector(rownames(hDA2Genes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hDA2) == TRUE) {seur$hDA2[i] <- "hDA2" }}


hNbGabaGenes = a[a$	hNbGaba == 1,]
hNbGaba=as.vector(rownames(hNbGabaGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hNbGaba) == TRUE) {seur$hNbGaba[i] <- "hNbGaba" }}


hGabaGenes = a[a$	hGaba == 1,]
hGaba=as.vector(rownames(hGabaGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hGaba) == TRUE) {seur$hGaba[i] <- "hGaba" }}


hSertGenes = a[a$hSert == 1,]
hSert=as.vector(rownames(hSertGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hSert) == TRUE) {seur$hSert[i] <- "hSert" }}


hOMTNGenes = a[a$hOMTN== 1,]
hOMTN=as.vector(rownames(hOMTNGenes))
for (i in 1:4183) {
if ((row.names(seur[i,]) %in% hOMTN) == TRUE) {seur$hOMTN[i] <- "hOMTN" }}


write.csv(seur, file = "Comb3SNQC_annotatedclustersMano04.csv")

getwd()
```

```{r}
# take care of duplicates! replace by genelist with duplicates

# 1. take seurat file, format duplicative genename cells to text, order a-z copy into annotatedclusters, ordered the same way. save as dupli. replace Genes if fix, if shows sth else.

g=read.csv("//atlas/users/sarah.nickels/jun/Comb3SNQC_annotatedclustersMano04_wDupli.csv", header = T )


fix(g)

library(dplyr)

d=duplicated(g$Genes[])
d[2]
for (n in 3:length(g)) {
  #replace length vector
for (i in 1:4183){
            if (d[i] == TRUE) { g[i,n] <- as.character(g[i-1,n]) }
}
  }

write.csv(g, file = "Comb3SNQC_annotatedclustersMano_wDupli04.csv")

```

```{r}
g=read.csv("//atlas/users/sarah.nickels/jun/Comb3SNQC_annotatedclustersMano_wDupli04.csv", header = T )


one = filter(g, g$cluster == 1)
two= filter(g, g$cluster == 2)
three= filter(g, g$cluster == 3)
four= filter(g, g$cluster == 4)
five= filter(g, g$cluster == 5)
six= filter(g, g$cluster == 6)
seven= filter(g, g$cluster == 7)
eight= filter(g, g$cluster == 8)
nine= filter(g, g$cluster == 9)
zero= filter(g, g$cluster == 0)

  
o=length(one$Genes)

ob=length(which(one$Basal == "Basal"))
oe=length(which(one$hEndo == "hEndo"))
op=length(which(one$	hPeric == "hPeric"))
om=length(which(one$hMgl == "hMgl"))
oo=length(which(one$	hOPC == "	hOPC"))

orc=length(which(one$	hRgl2c == "	hRgl2c"))
orb=length(which(one$hRgl2b == "hRgl2b"))
or=length(which(one$hRgl3 == "hRgl3"))
ora=length(which(one$	hRgl2a == "hRgl2a"))
orr=length(which(one$hRgl1 == "hRgl1"))

opm=length(which(one$hProgM == "hProgM"))
opbp=length(which(one$	hProgB == "hProgBP"))
opfpm=length(which(one$hProgFPM	 == "hProgFPM	"))
opfpl=length(which(one$hProgFPL == "hProgFPL"))
opn=length(which(one$	hNProg== "hNProg"))

on=length(which(one$	hNbM == "hNbM"))
onl=length(which(one$	hNbML1 == "hNbML1"))
orn=length(which(one$	hRN == "hRN"))
onll=length(which(one$hNbML5 == "hNbML5"))

odo=length(which(one$hDA0 == "hDA0"))
od=length(which(one$hDA1 == "hDA1"))
odd=length(which(one$hDA2 == "hDA2"))
og=length(which(one$hNbGaba == "hNbGaba"))
ogb=length(which(one$hGaba == "hGaba"))
ogba=length(which(one$hSert == "hSert"))
oomt=length(which(one$hOMTN == "hOMTN"))


t=length(two$Genes)

tb=length(which(two$Basal == "Basal"))
te=length(which(two$hEndo == "hEndo"))
tp=length(which(two$	hPeric == "hPeric"))
tm=length(which(two$hMgl == "hMgl"))
to=length(which(two$	hOPC == "	hOPC"))

trc=length(which(two$	hRgl2c == "	hRgl2c"))
trb=length(which(two$hRgl2b == "hRgl2b"))
tr=length(which(two$hRgl3 == "hRgl3"))
tra=length(which(two$	hRgl2a == "hRgl2a"))
trr=length(which(two$hRgl1 == "hRgl1"))

tpm=length(which(two$hProgM == "hProgM"))
tpbp=length(which(two$	hProgB == "hProgBP"))
tpfpm=length(which(two$hProgFPM	 == "hProgFPM	"))
tpfpl=length(which(two$hProgFPL == "hProgFPL"))
tpn=length(which(two$	hNProg== "hNProg"))

tn=length(which(two$	hNbM == "hNbM"))
tnl=length(which(two$	hNbML1 == "hNbML1"))
trn=length(which(two$	hRN == "hRN"))
tnll=length(which(two$hNbML5 == "hNbML5"))

tdo=length(which(two$hDA0 == "hDA0"))
td=length(which(two$hDA1 == "hDA1"))
tdd=length(which(two$hDA2 == "hDA2"))
tg=length(which(two$hNbGaba == "hNbGaba"))
tgb=length(which(two$hGaba == "hGaba"))
tgba=length(which(two$hSert == "hSert"))
tomt=length(which(two$hOMTN == "hOMTN"))


  
i=length(three$Genes)

bs=length(which(three$Basal == "Basal"))
es=length(which(three$hEndo == "hEndo"))
ps=length(which(three$	hPeric == "hPeric"))
ms=length(which(three$hMgl == "hMgl"))
os=length(which(three$	hOPC == "	hOPC"))

rc=length(which(three$	hRgl2c == "	hRgl2c"))
rb=length(which(three$hRgl2b == "hRgl2b"))
rs=length(which(three$hRgl3 == "hRgl3"))
ra=length(which(three$	hRgl2a == "hRgl2a"))
rr=length(which(three$hRgl1 == "hRgl1"))

pm=length(which(three$hProgM == "hProgM"))
pbp=length(which(three$	hProgB == "hProgBP"))
pfpm=length(which(three$hProgFPM	 == "hProgFPM	"))
pfpl=length(which(three$hProgFPL == "hProgFPL"))
pn=length(which(three$	hNProg== "hNProg"))

ns=length(which(three$	hNbM == "hNbM"))
nl=length(which(three$	hNbML1 == "hNbML1"))
rn=length(which(three$	hRN == "hRN"))
nll=length(which(three$hNbML5 == "hNbML5"))

do=length(which(three$hDA0 == "hDA0"))
ds=length(which(three$hDA1 == "hDA1"))
dd=length(which(three$hDA2 == "hDA2"))
gs=length(which(three$hNbGaba == "hNbGaba"))
gb=length(which(three$hGaba == "hGaba"))
gba=length(which(three$hSert == "hSert"))
omt=length(which(three$hOMTN == "hOMTN"))

f=length(four$Genes)

fb=length(which(four$Basal == "Basal"))
fe=length(which(four$hEndo == "hEndo"))
fp=length(which(four$	hPeric == "hPeric"))
fm=length(which(four$hMgl == "hMgl"))
fo=length(which(four$	hOPC == "	hOPC"))

frc=length(which(four$	hRgl2c == "	hRgl2c"))
frb=length(which(four$hRgl2b == "hRgl2b"))
fr=length(which(four$hRgl3 == "hRgl3"))
fra=length(which(four$	hRgl2a == "hRgl2a"))
frr=length(which(four$hRgl1 == "hRgl1"))

fpm=length(which(four$hProgM == "hProgM"))
fpbp=length(which(four$	hProgB == "hProgBP"))
fpfpm=length(which(four$hProgFPM	 == "hProgFPM	"))
fpfpl=length(which(four$hProgFPL == "hProgFPL"))
fpn=length(which(four$	hNProg== "hNProg"))

fn=length(which(four$	hNbM == "hNbM"))
fnl=length(which(four$	hNbML1 == "hNbML1"))
frn=length(which(four$	hRN == "hRN"))
fnll=length(which(four$hNbML5 == "hNbML5"))

fdo=length(which(four$hDA0 == "hDA0"))
fd=length(which(four$hDA1 == "hDA1"))
fdd=length(which(four$hDA2 == "hDA2"))
fg=length(which(four$hNbGaba == "hNbGaba"))
fgb=length(which(four$hGaba == "hGaba"))
fgba=length(which(four$hSert == "hSert"))
fomt=length(which(four$hOMTN == "hOMTN"))

ff=length(five$Genes)

ffb=length(which(five$Basal == "Basal"))
ffe=length(which(five$hEndo == "hEndo"))
ffp=length(which(five$	hPeric == "hPeric"))
ffm=length(which(five$hMgl == "hMgl"))
ffo=length(which(five$	hOPC == "	hOPC"))

ffrc=length(which(five$	hRgl2c == "	hRgl2c"))
ffrb=length(which(five$hRgl2b == "hRgl2b"))
ffr=length(which(five$hRgl3 == "hRgl3"))
ffra=length(which(five$	hRgl2a == "hRgl2a"))
ffrr=length(which(five$hRgl1 == "hRgl1"))

ffpm=length(which(five$hProgM == "hProgM"))
ffpbp=length(which(five$	hProgB == "hProgBP"))
ffpfpm=length(which(five$hProgFPM	 == "hProgFPM	"))
ffpfpl=length(which(five$hProgFPL == "hProgFPL"))
ffpn=length(which(five$	hNProg== "hNProg"))

ffn=length(which(five$	hNbM == "hNbM"))
ffnl=length(which(five$	hNbML1 == "hNbML1"))
ffrn=length(which(five$	hRN == "hRN"))
ffnll=length(which(five$hNbML5 == "hNbML5"))

ffdo=length(which(five$hDA0 == "hDA0"))
ffd=length(which(five$hDA1 == "hDA1"))
ffdd=length(which(five$hDA2 == "hDA2"))
ffg=length(which(five$hNbGaba == "hNbGaba"))
ffgb=length(which(five$hGaba == "hGaba"))
ffgba=length(which(five$hSert == "hSert"))
ffomt=length(which(five$hOMTN == "hOMTN"))


s=length(six$Genes)

sb=length(which(six$Basal == "Basal"))
se=length(which(six$hEndo == "hEndo"))
sp=length(which(six$	hPeric == "hPeric"))
sm=length(which(six$hMgl == "hMgl"))
so=length(which(six$	hOPC == "	hOPC"))

src=length(which(six$	hRgl2c == "	hRgl2c"))
srb=length(which(six$hRgl2b == "hRgl2b"))
sr=length(which(six$hRgl3 == "hRgl3"))
sra=length(which(six$	hRgl2a == "hRgl2a"))
srr=length(which(six$hRgl1 == "hRgl1"))

spm=length(which(six$hProgM == "hProgM"))
spbp=length(which(six$	hProgB == "hProgBP"))
spfpm=length(which(six$hProgFPM	 == "hProgFPM	"))
spfpl=length(which(six$hProgFPL == "hProgFPL"))
spn=length(which(six$	hNProg== "hNProg"))

sn=length(which(six$	hNbM == "hNbM"))
snl=length(which(six$	hNbML1 == "hNbML1"))
srn=length(which(six$	hRN == "hRN"))
snll=length(which(six$hNbML5 == "hNbML5"))

sdo=length(which(six$hDA0 == "hDA0"))
sd=length(which(six$hDA1 == "hDA1"))
sdd=length(which(six$hDA2 == "hDA2"))
sg=length(which(six$hNbGaba == "hNbGaba"))
sgb=length(which(six$hGaba == "hGaba"))
sgba=length(which(six$hSert == "hSert"))
somt=length(which(six$hOMTN == "hOMTN"))


ss=length(seven$Genes)

ssb=length(which(seven$Basal == "Basal"))
sse=length(which(seven$hEndo == "hEndo"))
ssp=length(which(seven$	hPeric == "hPeric"))
ssm=length(which(seven$hMgl == "hMgl"))
sso=length(which(seven$	hOPC == "	hOPC"))

ssrc=length(which(seven$	hRgl2c == "	hRgl2c"))
ssrb=length(which(seven$hRgl2b == "hRgl2b"))
ssr=length(which(seven$hRgl3 == "hRgl3"))
ssra=length(which(seven$	hRgl2a == "hRgl2a"))
ssrr=length(which(seven$hRgl1 == "hRgl1"))

sspm=length(which(seven$hProgM == "hProgM"))
sspbp=length(which(seven$	hProgB == "hProgBP"))
sspfpm=length(which(seven$hProgFPM	 == "hProgFPM	"))
sspfpl=length(which(seven$hProgFPL == "hProgFPL"))
sspn=length(which(seven$	hNProg== "hNProg"))

ssn=length(which(seven$	hNbM == "hNbM"))
ssnl=length(which(seven$	hNbML1 == "hNbML1"))
ssrn=length(which(seven$	hRN == "hRN"))
ssnll=length(which(seven$hNbML5 == "hNbML5"))

ssdo=length(which(seven$hDA0 == "hDA0"))
ssd=length(which(seven$hDA1 == "hDA1"))
ssdd=length(which(seven$hDA2 == "hDA2"))
ssg=length(which(seven$hNbGaba == "hNbGaba"))
ssgb=length(which(seven$hGaba == "hGaba"))
ssgba=length(which(seven$hSert == "hSert"))
ssomt=length(which(seven$hOMTN == "hOMTN"))


e=length(eight$Genes)

eb=length(which(eight$Basal == "Basal"))
ee=length(which(eight$hEndo == "hEndo"))
ep=length(which(eight$	hPeric == "hPeric"))
em=length(which(eight$hMgl == "hMgl"))
eo=length(which(eight$	hOPC == "	hOPC"))

erc=length(which(eight$	hRgl2c == "	hRgl2c"))
erb=length(which(eight$hRgl2b == "hRgl2b"))
er=length(which(eight$hRgl3 == "hRgl3"))
era=length(which(eight$	hRgl2a == "hRgl2a"))
err=length(which(eight$hRgl1 == "hRgl1"))

epm=length(which(eight$hProgM == "hProgM"))
epbp=length(which(eight$	hProgB == "hProgBP"))
epfpm=length(which(eight$hProgFPM	 == "hProgFPM	"))
epfpl=length(which(eight$hProgFPL == "hProgFPL"))
epn=length(which(eight$	hNProg== "hNProg"))

en=length(which(eight$	hNbM == "hNbM"))
enl=length(which(eight$	hNbML1 == "hNbML1"))
ern=length(which(eight$	hRN == "hRN"))
enll=length(which(eight$hNbML5 == "hNbML5"))

edo=length(which(eight$hDA0 == "hDA0"))
ed=length(which(eight$hDA1 == "hDA1"))
edd=length(which(eight$hDA2 == "hDA2"))
eg=length(which(eight$hNbGaba == "hNbGaba"))
egb=length(which(eight$hGaba == "hGaba"))
egba=length(which(eight$hSert == "hSert"))
eomt=length(which(eight$hOMTN == "hOMTN"))



ne=length(nine$Genes)

neb=length(which(nine$Basal == "Basal"))
nee=length(which(nine$hEndo == "hEndo"))
nep=length(which(nine$	hPeric == "hPeric"))
nem=length(which(nine$hMgl == "hMgl"))
neo=length(which(nine$	hOPC == "	hOPC"))

nerc=length(which(nine$	hRgl2c == "	hRgl2c"))
nerb=length(which(nine$hRgl2b == "hRgl2b"))
ner=length(which(nine$hRgl3 == "hRgl3"))
nera=length(which(nine$	hRgl2a == "hRgl2a"))
nerr=length(which(nine$hRgl1 == "hRgl1"))

nepm=length(which(nine$hProgM == "hProgM"))
nepbp=length(which(nine$	hProgB == "hProgBP"))
nepfpm=length(which(nine$hProgFPM	 == "hProgFPM	"))
nepfpl=length(which(nine$hProgFPL == "hProgFPL"))
nepn=length(which(nine$	hNProg== "hNProg"))

nen=length(which(nine$	hNbM == "hNbM"))
nenl=length(which(nine$	hNbML1 == "hNbML1"))
nern=length(which(nine$	hRN == "hRN"))
nenll=length(which(nine$hNbML5 == "hNbML5"))

nedo=length(which(nine$hDA0 == "hDA0"))
ned=length(which(nine$hDA1 == "hDA1"))
nedd=length(which(nine$hDA2 == "hDA2"))
neg=length(which(nine$hNbGaba == "hNbGaba"))
negb=length(which(nine$hGaba == "hGaba"))
negba=length(which(nine$hSert == "hSert"))
neomt=length(which(nine$hOMTN == "hOMTN"))


zne=length(zero$Genes)

zneb=length(which(zero$Basal == "Basal"))
znee=length(which(zero$hEndo == "hEndo"))
znep=length(which(zero$	hPeric == "hPeric"))
znem=length(which(zero$hMgl == "hMgl"))
zneo=length(which(zero$	hOPC == "	hOPC"))

znerc=length(which(zero$	hRgl2c == "	hRgl2c"))
znerb=length(which(zero$hRgl2b == "hRgl2b"))
zner=length(which(zero$hRgl3 == "hRgl3"))
znera=length(which(zero$	hRgl2a == "hRgl2a"))
znerr=length(which(zero$hRgl1 == "hRgl1"))

znepm=length(which(zero$hProgM == "hProgM"))
znepbp=length(which(zero$	hProgB == "hProgBP"))
znepfpm=length(which(zero$hProgFPM	 == "hProgFPM	"))
znepfpl=length(which(zero$hProgFPL == "hProgFPL"))
znepn=length(which(zero$	hNProg== "hNProg"))

znen=length(which(zero$	hNbM == "hNbM"))
znenl=length(which(zero$	hNbML1 == "hNbML1"))
znern=length(which(zero$	hRN == "hRN"))
znenll=length(which(zero$hNbML5 == "hNbML5"))

znedo=length(which(zero$hDA0 == "hDA0"))
zned=length(which(zero$hDA1 == "hDA1"))
znedd=length(which(zero$hDA2 == "hDA2"))
zneg=length(which(zero$hNbGaba == "hNbGaba"))
znegb=length(which(zero$hGaba == "hGaba"))
znegba=length(which(zero$hSert == "hSert"))
zneomt=length(which(zero$hOMTN == "hOMTN"))



oneall <- c(ob,oe,op,om,oo,orc,orb,or,ora,orr,opm,opbp,opfpm,opfpl,opn,on,onl,orn,onll,odo,od,odd,og,ogb,ogba,oomt)
oneperc= oneall/o*100
twoall <- c(tb,te,tp,tm,to,trc,trb,tr,tra,trr,tpm,tpbp,tpfpm,tpfpl,tpn,tn,tnl,trn,tnll,tdo,td,tdd,tg,tgb,tgba,tomt)
twoperc= twoall/t*100
threeall<- c(bs,es,ps,ms,os,rc,rb,rs,ra,rr,pm,pbp,pfpm,pfpl,pn,ns,nl,rn,nll,do,ds,dd,gs,gb,gba,omt)
threeperc= threeall/i*100
fourall<- c(fb,fe,fp,fm,fo,frc,frb,fr,fra,frr,fpm,fpbp,fpfpm,fpfpl,fpn,fn,fnl,frn,fnll,fdo,fd,fdd,fg,fb,fgba,fomt)
fourperc= fourall/f*100
fiveall<- c(ffb,ffe,ffp,fm,ffo,ffrc,ffrb,ffr,ffra,ffrr,ffpm,ffpbp,ffpfpm,ffpfpl,ffpn,ffn,ffnl,ffrn,ffnll,ffdo,ffd,ffdd,ffg,ffb,ffgba,ffomt)
fiveperc= fiveall/ff*100
sixall<- c(sb,se,sp,sm,so,src,srb,sr,sra,srr,spm,spbp,spfpm,spfpl,spn,sn,snl,srn,snll,sdo,sd,sdd,sg,sb,sgba,somt)
sixperc= sixall/s*100
sevenall<- c(ssb,sse,ssp,ssm,sso,ssrc,ssrb,ssr,ssra,ssrr,sspm,sspbp,sspfpm,sspfpl,sspn,sn,ssnl,ssrn,ssnll,ssdo,ssd,ssdd,ssg,ssb,ssgba,ssomt)
sevenperc= sevenall/ss*100
eightall<- c(eb,ee,ep,em,eo,erc,erb,er,era,err,epm,epbp,epfpm,epfpl,epn,en,enl,ern,enll,edo,ed,edd,eg,eb,egba,eomt)
eightperc= eightall/e*100
nineall<- c(neb,nee,nep,nem,neo,nerc,nerb,ner,nera,nerr,nepm,nepbp,nepfpm,nepfpl,nepn,nen,nenl,nern,nenll,nedo,ned,nedd,neg,neb,negba,neomt)
nineperc= nineall/ne*100
zeroall<- c(zneb,znee,znep,znem,zneo,znerc,znerb,zner,znera,znerr,znepm,znepbp,znepfpm,znepfpl,znepn,znen,znenl,znern,znenll,znedo,zned,znedd,zneg,zneb,znegba,zneomt)
zeroperc= zeroall/zne*100

					
p= data.frame(oneperc, twoperc, threeperc, fourperc, fiveperc, sixperc, sevenperc, eightperc, nineperc, zeroperc)


row.names(p) <- c("Basal",	"hEndo"	, "hPeric",	"hMgl",	"hOPC",	"hRgl2c",	"hRgl2b",	"hRgl2a",	"hRgl3",	"hRgl1",	"hProgM",	"hProgBP",	"hProgFPL",	"hProgFPM",	"hNProg",	"hNbM","hNbML1","hRN","hNbML5",	"hDA0",	"hDA1",	"hDA2",	"hNbGaba",	"hGaba"	,"hSert",	"hOMTN")

  write.csv(p, file = "Comb3SNQC_percentclusters.csv")

  
  #percentage of genes in one cluster (eg cl1) that define one cell type
  # number of genes defining BASAL/total number of genes cluster1
  
k= data.frame(oneall, twoall, threeall, fourall, fiveall, sixall, sevenall, eightall, nineall, zeroall)

row.names(k) <- c("Basal",	"hEndo"	, "hPeric",	"hMgl",	"hOPC",	"hRgl2c",	"hRgl2b",	"hRgl2a",	"hRgl3",	"hRgl1",	"hProgM",	"hProgBP",	"hProgFPL",	"hProgFPM",	"hNProg",	"hNbM","hNbML1","hRN","hNbML5",	"hDA0",	"hDA1",	"hDA2",	"hNbGaba",	"hGaba"	,"hSert",	"hOMTN")

  write.csv(k, file = "Comb3SNQC_genenumberclusters.csv")

```
# add cell names La Mano
```{r}


#Comb3SNQC_ids <- c("GLIA", "GLIA1", "NEUR&NB", "PROG", "DN&SERO", "DNOMT", "DN", "DN1", "MGL")
Comb3SNQC_ids <- c("GLIA", "NEUR & NB", "NEUR", "GABA", "yDN ", "GABA I/PROG", "mDN I (OMTN)", "GLIA I", "MGL")

names(Comb3SNQC_ids) <- levels(Comb3SNQC)
Comb3SNQC <- RenameIdents(Comb3SNQC, Comb3SNQC_ids)
DimPlot(Comb3SNQC, reduction = "umap", label = TRUE, pt.size = 0.5, split.by = "Model") + NoLegend()


```

#-------------------------------------------------------------------------------------------------------------------------------------------------

# Combine All Mgl vs No_Mgl add column Mgl
```{r}

head(Comb3SNQC@meta.data, 5)


groups <- sample(c(""), size = 33538, replace = TRUE)
names(groups) <- colnames(Comb3SNQC)
Comb3SNQC <- AddMetaData(object = Comb3SNQC, metadata = groups, col.name = "Mgl")
head(Comb3SNQC@meta.data, 5)


Comb3SNQC$Mgl[1:1364] <- "MOs"
Comb3SNQC$Mgl[2756:3560] <- "pMGL-MOs"
Comb3SNQC$Mgl[1365:2755] <- "pMGL-MOs"


head(Comb3SNQC@meta.data, 5)
```


#add Column combined cluster and Mgl
```{r}
Comb3SNQC$CLUSTER_Model <- paste(Comb3SNQC$seurat_clusters, Comb3SNQC$Model, sep = "_")
Comb3SNQC$CLUSTER_Mgl <- paste(Comb3SNQC$seurat_clusters, Comb3SNQC$Mgl, sep = "_")
Comb3SNQC$CELL_ID <-Idents(Comb3SNQC)
Comb3SNQC$CELLID_Mgl <- paste(Comb3SNQC$CELL_ID, Comb3SNQC$Mgl, sep = "_")


head(Comb3SNQC@meta.data, 100)
Idents(Comb3SNQC)

```


#verify cell cluster names by hand
```{r}
# Neuronal cells Mature, Young, Progenitors
VlnPlot(Comb3SNQC, features = c("MAP2", "RBFOX3", "DLG4", "SYP", "TRIB1" ,"NEUROD1", "TUBB", "DCX", "TRIB2", "ASCL1"), slot = "counts", log = TRUE)
# Neuronal cells subsets GLUT, GABA, SER
VlnPlot(Comb3SNQC, features = c("GRIN1", "SLC17A7", "GLUL","GAD1", "SLC6A1","GABRA1", "TPH1","SLC6A4", "FEV", "CHAT","SLC18A3", "ACHE"), slot = "counts", log = TRUE)
# Dopaminergic neurons and midbrain identity
VlnPlot(Comb3SNQC, features = c("TH","PTX3", "OTX2" ,"EN2","EN2", "SOX6","FOXA2", "LMX1A","LMX1B", "KCNJ6","CALB1", "NR4A2", "SLC6A3", "SHH", "NKX6-1"), slot = "counts", log = TRUE)
# Glia
VlnPlot(Comb3SNQC, features = c("GFAP","S100B","AQP4","SLC1A3 ", "ALDH1L1", "CNP","CLDN11","MBP","OLIG1","CSPG4","AIF1"), slot = "counts", log = TRUE)
# Stem cells
VlnPlot(Comb3SNQC, features = c("FOXA2", "LMX1A","NES","SOX2","SOX1" ,"PAX6", "MSI1", "NOTCH1", "SOX10", "HES5", "HES1", "FABP7", "SLC1A3", "VIM"), slot = "counts", log = TRUE)

VlnPlot(Comb3SNQC, features = c("CALB1", "NTN1","DCC","SLIT1","ROBO1","EPHNA1", "WNT1", "FGF8", "GRIN2B", "GAD2"), slot = "counts", log = TRUE)

```

```{r}

mid = c("TH","PTX3", "OTX2" ,"EN2", "SOX6","FOXA2", "LMX1A","LMX1B", "KCNJ6","CALB1", "NR4A2", "SLC6A3", "SHH", "NKX6-1")
# Glia
#stemness


chol= c("CHAT","SLC18A3", "ACHE")

stem= c("SOX2","PAX6","HES5","ASCL1","SOX1","PAX3","DACH1","LMO3","NR2F1","PLAGL1","LIX1","HOXA2","IRX3TH")
#neuronal

neur= c("BCL11A","CACNA2D2","CALB2","CD274","CELF4","CLSTN2","DLX1","DPYSL5","DYNC1I1,","EBF3","FOSL2","ISLR2","L1CAM","MEG3","NHLH2","NPAS4","NPY","NXPH4","RELN","RGMB","SLC32A1","SST","STMN2","SYNGR3","SYT4","TMEM130","VGF","VSTM2L")

#dopamine

dopa= c("NR4A2","PBX1","GRIA3","TH","EN1","TMCC3","NTM","DDC","CAMK2N1","ALDH1A1","APP","PDZRN4","PCDH10","MEG","ERBB4","SLC10A4","BEX5","FOXA2","NPY1R","GPC2","KCNJ6","LMX1B","HTRA2","HTRA3","HTRA4")


#glutamatergic
glut = c("SLC1A1","SLC1A2","SLC1A3","SLC17A6","SLC17A7","GLS","GLS2","GRIN1","GRIN2A","GRIN2B","GRIN2C","GRIN2D","GRIN3B","GRINA","GRIA1","GRIA2","GRIA4","HTR5BP","HTR7P1","HTRA1")


#gabba
gab = c("GAD1","GAD2","GABARAP","GABARAPL1","GABARAPL2","GABARAPL3","ABAT")

#serotonergic
sero= c("SLC6A4","SLC18A2","TPH1","TPH2","FEV","HTR1D","HTR1DP1","HTR1E","HTR1F","HTR2A","HTR2A-AS1","HTR2B","HTR2C","HTR3A","HTR3B","HTR3D","HTR4","HTR5A","HTR5A-AS1")

#VTA
vta= c("ALDH1A1","TRHR", "CD24","SLC18A2",  "FGF1", "NRIP3", "MPP6", "NTS","CCK",  "SOX6", "GRIN2C", "SNCG", "IGF1", "ADCYAP1", "GRP", "LPL", "CALB1", "SLC32A1", "VIP", "TACR3","DCC", "UNC5H", "OTX2", "ZNF503 ", "SATB1")

#maturity
mat=c("
 RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1")


DotPlot(Comb3SNQC, features=c(stem,dopa,neur,glut,chol,gab,sero) ,dot.scale = 10) + RotatedAxis()

```


```{r}
#stemness
DotPlot(Comb3SNQC, features = c("SOX2","PAX6","HES5","ASCL1","SOX1","PAX3","DACH1","LMO3","NR2F1","PLAGL1","LIX1","HOXA2","FOXA2","IRX3TH"),dot.scale = 10, group.by = "CELLID_Mgl") + RotatedAxis()
DotPlot(Comb3SNQC, features = c("SOX2","PAX6","HES5","ASCL1","SOX1","PAX3","DACH1","LMO3","NR2F1","PLAGL1","LIX1","HOXA2","FOXA2","IRX3TH"),dot.scale = 10) + RotatedAxis()

#neuronal
DotPlot(Comb3SNQC, features = c("BCL11A","CACNA2D2","CALB2","CD274","CELF4","CLSTN2","DLX1","DPYSL5","DYNC1I1,","EBF3","FOSL2","ISLR2","L1CAM","MEG3","NHLH2","NPAS4","NPY","NXPH4","RELN","RGMB","SLC17A6","SLC32A1","SST","STMN2","SYNGR3","SYT4","TMEM130","VGF","VSTM2L"),  group.by = "CELLID_Mgl") + RotatedAxis()
DotPlot(Comb3SNQC, features = c("BCL11A","CACNA2D2","CALB2","CD274","CELF4","CLSTN2","DLX1","DPYSL5","DYNC1I1,","EBF3","FOSL2","ISLR2","L1CAM","MEG3","NHLH2","NPAS4","NPY","NXPH4","RELN","RGMB","SLC17A6","SLC32A1","SST","STMN2","SYNGR3","SYT4","TMEM130","VGF","VSTM2L")) + RotatedAxis()

#dopamine
DotPlot(Comb3SNQC, features = c("NR4A2","PBX1","GRIA3","TH","EN1","TMCC3","NTM","DDC","CAMK2N1","ALDH1A1","APP","PDZRN4","PCDH10","MEG","ERBB4","SLC10A4","BEX5","FOXA2","NPY1R","GPC2","KCNJ6","LMX1B","HTRA2","HTRA3","HTRA4"),  group.by = "CELLID_Mgl") + RotatedAxis()
DotPlot(Comb3SNQC, features = c("NR4A2","PBX1","GRIA3","TH","EN1","TMCC3","NTM","DDC","CAMK2N1","ALDH1A1","APP","PDZRN4","PCDH10","MEG","ERBB4","SLC10A4","BEX5","FOXA2","NPY1R","GPC2","KCNJ6","LMX1B","HTRA2","HTRA3","HTRA4")) + RotatedAxis()

#glutamatergic
DotPlot(Comb3SNQC, features = c("SLC1A1","SLC1A2","SLC1A3","SLC17A6","SLC17A7","GLS","GLS2","GRIN1","GRIN2A","GRIN2B","GRIN2C","GRIN2D","GRIN3A","GRIN3B","GRINA","GRIA1","GRIA2","GRIA3","GRIA4","HTR5BP","HTR7P1","HTRA1")) + RotatedAxis()
DotPlot(Comb3SNQC, features = c("SLC1A1","SLC1A2","SLC1A3","SLC17A6","SLC17A7","GLS","GLS2","GRIN1","GRIN2A","GRIN2B","GRIN2C","GRIN2D","GRIN3A","GRIN3B","GRINA","GRIA1","GRIA2","GRIA3","GRIA4","HTR5BP","HTR7P1","HTRA1"), group.by = "CELLID_Mgl") + RotatedAxis()

#gabba
DotPlot(Comb3SNQC, features = c("GAD1","GAD2","GABARAP","GABARAPL1","GABARAPL2","GABARAPL3","ABAT")) + RotatedAxis()
DotPlot(Comb3SNQC, features = c("GAD1","GAD2","GABARAP","GABARAPL1","GABARAPL2","GABARAPL3","ABAT"), group.by = "CELLID_Mgl") + RotatedAxis()

#serotonergic
DotPlot(Comb3SNQC, features = c("SLC6A4","SLC18A2","TPH1","TPH2","FEV","HTR1D","HTR1DP1","HTR1E","HTR1F","HTR2A","HTR2A-AS1","HTR2B","HTR2C","HTR3A","HTR3B","HTR3D","HTR4","HTR5A","HTR5A-AS1")) + RotatedAxis()
DotPlot(Comb3SNQC, features = c("SLC6A4","SLC18A2","TPH1","TPH2","FEV","HTR1D","HTR1DP1","HTR1E","HTR1F","HTR2A","HTR2A-AS1","HTR2B","HTR2C","HTR3A","HTR3B","HTR3D","HTR4","HTR5A","HTR5A-AS1"), group.by = "CELLID_Mgl") + RotatedAxis()

#VTA
DotPlot(Comb3SNQC, features = c("ALDH1A1","TRHR", "CD24","SLC18A2",  "FGF1", "NRIP3", "MPP6", "NTS","CCK",  "SOX6", "GRIN2C", "SNCG", "IGF1", "ADCYAP1", "GRP", "LPL", "CALB1", "SLC32A1", "VIP", "TACR3","DCC", "UNC5H", "OTX2", "ZNF503 ", "SATB1")) + RotatedAxis()

```

```{r}

#stemness
a=DotPlot(Comb3SNQC, features = c("SOX2","PAX6","HES5","ASCL1","SOX1","PAX3","DACH1","LMO3","NR2F1","PLAGL1","LIX1","HOXA2","FOXA2","IRX3TH", "SLC1A3", "MSI1", "VIM", "NES", "SHH")) + RotatedAxis()

#neuronal
b=DotPlot(Comb3SNQC, features = c("BCL11A","CACNA2D2","CALB2","CD274","CELF4","CLSTN2","DLX1","DPYSL5","DYNC1I1,","EBF3","FOSL2","ISLR2","L1CAM","MEG3","NHLH2","NPAS4","NPY","NXPH4","RELN","RGMB","SLC17A6","SLC32A1","SST","STMN2","SYNGR3","SYT4","TMEM130","VGF","VSTM2L", "MAP2", "RBFOX3", "DLG4", "SYP", "TRIB1" ,"NEUROD1", "TUBB", "DCX", "TRIB2", "ASCL1")) + RotatedAxis()

#dopamine
c=DotPlot(Comb3SNQC, features = c("NR4A2","PBX1","GRIA3","TH","EN1","TMCC3","NTM","DDC","CAMK2N1","ALDH1A1","APP","PDZRN4","PCDH10","MEG","ERBB4","SLC10A4","BEX5","NPY1R","GPC2","HTRA2","HTRA3","HTRA4","PTX3", "OTX2" ,"EN2", "SOX6","FOXA2", "LMX1A","LMX1B", "KCNJ6","CALB1","SLC6A3", "SHH", "NKX6-1" )) + RotatedAxis()


#glutamatergic
d=DotPlot(Comb3SNQC, features = c("SLC1A1","SLC1A2","SLC1A3","SLC17A6","SLC17A7","GLS","GLS2","GRIN1","GRIN2A","GRIN2B","GRIN2C","GRIN2D","GRIN3A","GRIN3B","GRINA","GRIA1","GRIA2","GRIA3","GRIA4","HTR5BP","HTR7P1","HTRA1")) + RotatedAxis()

#gabba
e=DotPlot(Comb3SNQC, features = c("GAD1","GAD2","GABARAP","GABARAPL1","GABARAPL2","GABARAPL3","ABAT","CHAT","SLC18A3", "ACHE")) + RotatedAxis()

#serotonergic
f=DotPlot(Comb3SNQC, features = c("SLC6A4","SLC18A2","TPH1","TPH2","FEV","HTR1D","HTR1DP1","HTR1E","HTR1F","HTR2A","HTR2A-AS1","HTR2B","HTR2C","HTR3A","HTR3B","HTR3D","HTR4","HTR5A","HTR5A-AS1")) + RotatedAxis()

#VTA
g=DotPlot(Comb3SNQC, features = c("ALDH1A1","TRHR", "CD24","SLC18A2",  "FGF1", "NRIP3", "MPP6", "NTS","CCK",  "SOX6", "GRIN2C", "SNCG", "IGF1", "ADCYAP1", "GRP", "LPL", "CALB1", "SLC32A1", "VIP", "TACR3","DCC", "UNC5H", "OTX2", "ZNF503 ", "SATB1")) + RotatedAxis()

# maturity
l=DotPlot(Comb3SNQC, features =c("
 RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1")
) + RotatedAxis()

m=DotPlot(Comb3SNQC, features =c("CHAT","SLC18A3", "ACHE")
) + RotatedAxis()

pdf("marker.pdf",height = 5, width = 10)
print(b)
print(c)
print(l)
dev.off()

pdf("marker1.pdf",height = 3, width = 7)
print(g)
print(a)
print(d)
print(f)
print(e)
dev.off()

pdf("marker2.pdf",height = 3, width = 7)
print(e)
print(m)
dev.off()


```


```{r}

#Comb3SNQC_ids1 <- c("NSC", "RGL", "yNEUR&NB", "PROG", "imGABBA", "imDN", "GABA", "DN", "MGL")
#Comb3SNQC_ids1 <- c("RGL", "yNEUR", "CHOL", "GABA", "DN&GLUT", "PROG ", "DN", "NSC", "MGL")
Idents(Comb3SNQC) = "seurat_clusters"
levels(Comb3SNQC) 

Comb3SNQC_ids1 <- c("midNESC", "NB", "yDN&CN", "mDN(A10)&GlN&GaN","mDN(A10)&GlN&GaN" , "PROG", "mDN(A9)&SN","RGL", "MGL")

names(Comb3SNQC_ids1) <- levels(Comb3SNQC)
Comb3SNQC <- RenameIdents(Comb3SNQC, Comb3SNQC_ids1)
umap1=DimPlot(Comb3SNQC, reduction = "umap",  label = F, pt.size = 1, split.by = "Mgl", label.size = 4) 
umap=DimPlot(Comb3SNQC, reduction = "umap",  label = TRUE, pt.size = 1, label.size = 4) + NoLegend()
umap=DimPlot(Comb3SNQC, reduction = "umap",  label = TRUE, pt.size = 1, label.size = 4, group.by = "Model") 

pdf("umap.pdf")
print(umap)
dev.off()

pdf("umap1.pdf")
print(umap1)
dev.off()
```
# Do heatmap with marker genes
```{r}


my_levels = c("RGL", "midNESC","PROG","NB","yDN&CN","mDN(A10)&GlN&GaN","mDN(A9)&SN","MGL")
levels(Comb3SNQC)=my_levels

HP1=DoHeatmap(Comb3SNQC, features = c( "SLC1A3","SOX2", "SHH","LMX1A", "FOXA2", "MSI1", "VIM","STMN1","DCX","SYP","ROBO1", "DCC", "SLC18A3","GAD1", "SLC17A6", "SLC18A2", "TH","KCNJ6", "ADCYAP1", "CALB1", "AIF1"), hjust= F, angle= 45, size = 2, draw.lines= 1)

DoHeatmap(Comb3SNQC, features = c( "SLC1A3", "STMN1","GAT1",  "SYP",  "GABRA2", "GLUL", "SHH", "VIM", "TH","MKI67",  "SOX2", "AIF1"))

DotPlot(Comb3SNQC, features = c( "SLC1A3", "STMN1","GAT1",  "SYP", "SLC18A3",   "SHH", "VIM", "TH","MKI67",  "SOX2", "AIF1"))


pdf("HP1.pdf")
print(HP1)
dev.off()

```



```{r}
saveRDS(Comb3SNQC, "C:/Users/sarah.nickels/Comb3SNQC.rds")
#saveRDS(Comb3SNQC, "C:/Users/sarah.nickels/Comb3SNQC_SCT.rds")

```


```{r}
Comb3SNQC=readRDS("C:/Users/sarah.nickels/Comb3SNQC.rds")
head(Comb3SNQC@meta.data, 5)

```

------------------------------------------------------------------------------------------------------------------------------------
Conserved and variable features

Find conserved markers independent of microglia
```{r}
install.packages('BiocManager') 
BiocManager::install('multtest') 
install.packages('metap')
library(BiocManager)

NoMgl.markers.consGlia <- FindConservedMarkers(Comb3SNQC, ident.1 = "", grouping.var = "Mgl", verbose = FALSE)
head(NoMgl.markers.consGlia)

```

```{r}
library(pheatmap)
library(RColorBrewer)

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}


Comb3SNQC <- FindVariableFeatures(Comb3SNQC, selection.method = "vst", nfeatures = 2000)
top500 <- head(VariableFeatures(Comb3SNQC), 500)


genes_variable <- subset(Comb3SNQC, features = top500)
genes_variable_expr <- AverageExpression(genes_variable)$RNA


a=as.matrix(genes_variable_expr)

NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr),1,Z_Normalize))


pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
 "RdYlBu")))(100), show_rownames = F, angle_col = 45,  fontsize = 5, cellwidth = 20, cellheight = 0.4, filename= "heatmapHVG.pdf")



```

##Correlation 
```{r}
Cor.av.exp <- AverageExpression(genes_variable)$RNA
dim(Cor.av.exp)
Cor.av.exp <- as.data.frame(cor(Cor.av.exp, method = "spearman"))
Cor.av.exp$x <- rownames(Cor.av.exp)
Cor.data <- tidyr::gather(data = Cor.av.exp, y, correlation, Cor.av.exp$x)
p <- ggplot(Cor.data, aes(x, y, fill = correlation)) + geom_raster()+scale_fill_gradientn(colors = c("#00AFBB", "white",  "#FC4E07"))+ 
  labs(title=" ")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 12, hjust = 1),
        axis.text.y=element_text(size=12),
        axis.title.x = element_blank(),axis.title.y=element_blank())+
  coord_fixed()
t<- cowplot::ggdraw(cowplot::add_sub(p, "Spearman correlation between models",hjust=0, size=9))
  print(t)
  
  
  pdf("ccorr.pdf")
print(t)
dev.off()
```


```{r}

Ident_model <- subset(Comb3SNQC)

Idents(Ident_model) = Ident_model$Model
top100<- head(VariableFeatures(Ident_model), 100)

genes_variable1 <- subset(Ident_model, features = top100)

genes_variable_expr1 <- AverageExpression(genes_variable1)$RNA


Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}
NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr1),1,Z_Normalize))

pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45, fontsize_col = 14,fontsize_row = 6, cellwidth = 40, cellheight = 5, main='100 most variable genes', filename= "heatmapHVGMODEL.pdf")


```

##Correlation
```{r}
Cor.av.exp <- AverageExpression(genes_variable1)$RNA
dim(Cor.av.exp)
Cor.av.exp <- as.data.frame(cor(Cor.av.exp, method = "spearman"))
Cor.av.exp$x <- rownames(Cor.av.exp)
Cor.data <- tidyr::gather(data = Cor.av.exp, y, correlation, Cor.av.exp$x)
p <- ggplot(Cor.data, aes(x, y, fill = correlation)) + geom_raster()+scale_fill_gradientn(colors = c("#00AFBB", "white",  "#FC4E07"))+ 
  labs(title=" ")+
  theme(axis.text.x = element_text(angle = 45, vjust = 1, 
                                   size = 12, hjust = 1),
        axis.text.y=element_text(size=12),
        axis.title.x = element_blank(),axis.title.y=element_blank())+
  coord_fixed()
t<- cowplot::ggdraw(cowplot::add_sub(p, "Spearman correlation between models",hjust=0, size=9))
  print(t)
```

```{r}

Ident_Mgl <- subset(Comb3SNQC)

Idents(Ident_Mgl) = Ident_Mgl$Mgl
top100<- head(VariableFeatures(Ident_Mgl), 100)

genes_variable <- subset(Ident_Mgl, features = top100)

genes_variable_expr <- AverageExpression(genes_variable)$RNA


Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}
NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr),1,Z_Normalize))

pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
 "RdYlBu")))(100), show_rownames = T, angle_col = 45, fontsize_col = 14,fontsize_row = 6, cellwidth = 40, cellheight = 5, main='100 most variable genes', filename= "heatmapHVGMgl.pdf")


```


--------------------------------------------------------------------------------------------------------------------------------------
DEG analysis

#DEG No_Mgl -vs K7 -vs 163
```{r}

NovsMglSN3<- subset(Comb3SNQC)
Idents(NovsMglSN3) <- "Model"
levels(NovsMglSN3)

No_MglvsMgl_K7.markersSN3 <- FindMarkers(NovsMglSN3, ident.1 = "No_Mgl", ident.2 = "Mgl_K7", verbose = FALSE)
head(No_MglvsMgl_K7.markersSN3, n = 15)
No_MglvsMgl_163.markersSN3 <- FindMarkers(NovsMglSN3, ident.1 = "No_Mgl", ident.2 = "Mgl_163", verbose = FALSE)
head(No_MglvsMgl_163.markersSN3, n = 15)

write.csv(No_MglvsMgl_K7.markersSN3, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_K7.markers.csv" )
write.csv(No_MglvsMgl_163.markersSN3, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_163.markers.csv" )


```

#DEG Mgl vn NoMgl

```{r}
NovsMgld<- subset(Comb3SNQC)
Idents(NovsMgld) <- "Mgl"
levels(NovsMgld)
No_MglvsMgl.markersd <- FindMarkers(NovsMgld, ident.1 = "MOs", ident.2 = "pMGL-MOs", verbose = FALSE)
head(No_MglvsMgl.markersd, n = 15)


write.csv(No_MglvsMgl.markersd, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl.markers.csv" )


```


#DEG heatmap

#NoMgl vs Mgl
```{r}

library(pheatmap)
library(RColorBrewer)

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}

top100a <- head(rownames(No_MglvsMgl.markersd), 100)



NovsMglH<- subset(Comb3SNQC)
genes_variablea <- subset(NovsMglH, features = top100a)
genes_variable_expra <- AverageExpression(genes_variablea)$RNA


a=as.matrix(genes_variable_expra)

NormalisedData_Zscorea <- t(apply(as.matrix(genes_variable_expra),1,Z_Normalize))


#pheatmap(NormalisedData_Zscorea, colorRampPalette(rev(brewer.pal(n = 5, name =
#  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 7.5, main='Expression of Top100 DEG', filename= "heatmapNOvsMGLCLUSTERS.pdf")


is.na(NormalisedData_Zscorea) %>% table()
NormalisedData_Zscorea<- na.omit(NormalisedData_Zscorea)
is.na(NormalisedData_Zscorea) %>% table()

pheatmap(NormalisedData_Zscorea, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 7.5, main='Expression of Top100 DEG', filename= "heatmapNOvsMGLCLUSTERS.pdf")


```



```{r}
NovsMglH1<- subset(Comb3SNQC)
Idents(NovsMglH1) = NovsMglH1$Model

genes_variableH <- subset(NovsMglH1, features = top100a)
genes_variable_exprH <- AverageExpression(genes_variableH)$RNA

a=as.matrix(genes_variable_expra)

NormalisedData_ZscoreH <- t(apply(as.matrix(genes_variable_exprH),1,Z_Normalize))


#pheatmap(NormalisedData_ZscoreH, colorRampPalette(rev(brewer.pal(n = 5, name =
#  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 30, cellheight = 10, main='Average expression of DEG', filename= "heatmapNovsMGLMODEL.pdf")

is.na(NormalisedData_ZscoreH) %>% table()
NormalisedData_ZscoreH<- na.omit(NormalisedData_ZscoreH)
is.na(NormalisedData_ZscoreH) %>% table()

pheatmap(NormalisedData_ZscoreH, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 30, cellheight = 10, main='Average expression of DEG', filename= "heatmapNovsMGLMODEL.pdf")
```

```{r}
NovsMglH2<- subset(Comb3SNQC)
Idents(NovsMglH2) = NovsMglH2$Mgl

genes_variableH2 <- subset(NovsMglH2, features = top100a)
genes_variable_exprH2 <- AverageExpression(genes_variableH2)$RNA

a=as.matrix(genes_variable_exprH2)

NormalisedData_ZscoreH2 <- t(apply(as.matrix(genes_variable_exprH2),1,Z_Normalize))


pheatmap(NormalisedData_ZscoreH2, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 8, cellwidth = 60, cellheight = 7.5, main='Expression of Top100 DEG', filename= "heatmapNovsMGLMICRO.pdf")
```


```{r}
NovsMglH2<- subset(Comb3SNQC)
Idents(NovsMglH2) = NovsMglH2$CELLID_Mgl

genes_variableH2 <- subset(NovsMglH2, features = top100a)
genes_variable_exprH2 <- AverageExpression(genes_variableH2)$RNA

a=as.matrix(genes_variable_exprH2)

NormalisedData_ZscoreH2 <- t(apply(as.matrix(genes_variable_exprH2),1,Z_Normalize))


pheatmap(NormalisedData_ZscoreH2, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 8, cellwidth = 60, cellheight = 7.5, main='Expression of Top100 DEG', filename= "heatmapNovsMGLMICRObycluster.pdf")
```
#same can be done for 1by one comparison

```{r}


NovsMglcl<- subset(Comb3SNQC)
Idents(NovsMglcl) <- "CELLID_Mgl"
levels(NovsMglcl)
No_MglvsMgl.markersclyDNCN <- FindMarkers(NovsMglcl, ident.1 = "yDN&CN_MOs", ident.2 = "yDN&CN_pMGL-MOs", verbose = FALSE)
No_MglvsMgl.markersclPROG <- FindMarkers(NovsMglcl, ident.1 = "PROG_MOs", ident.2 = "PROG_pMGL-MOs", verbose = FALSE)
No_MglvsMgl.markersclmidNESC <- FindMarkers(NovsMglcl, ident.1 = "midNESC_MOs", ident.2 = "midNESC_pMGL-MOs", verbose = FALSE)
No_MglvsMgl.markersclNB <- FindMarkers(NovsMglcl, ident.1 = "NB_MOs", ident.2 = "NB_pMGL-MOs", verbose = FALSE)
No_MglvsMgl.markersclRGL <- FindMarkers(NovsMglcl, ident.1 = "RGL_MOs", ident.2 = "RGL_pMGL-MOs", verbose = FALSE)
No_MglvsMgl.markersclmDNA10GlNGaN <- FindMarkers(NovsMglcl, ident.1 = "mDN(A10)&GlN&GaN_MOs", ident.2 = "mDN(A10)&GlN&GaN_pMGL-MOs", verbose = FALSE)
No_MglvsMgl.markersclmDNA9SN <- FindMarkers(NovsMglcl, ident.1 = "mDN(A9)&SN_MOs", ident.2 = "mDN(A9)&SN_pMGL-MOs", verbose = FALSE)


write.csv(No_MglvsMgl.markersclyDNCN, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_yDNCN.markers.csv" )
write.csv(No_MglvsMgl.markersclPROG, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_PROG.markers.csv" )
write.csv(No_MglvsMgl.markersclmidNESC, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_midNESC.markers.csv" )
write.csv(No_MglvsMgl.markersclNB, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_NB.markers.csv" )
write.csv(No_MglvsMgl.markersclRGL, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_RGL.markers.csv" )
write.csv(No_MglvsMgl.markersclmDNA10GlNGaN, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_mDN(A10)&GlN&GaN.markers.csv" )
write.csv(No_MglvsMgl.markersclmDNA9SN, "//atlas/users/sarah.nickels/jun/Comb3SNQC_No_MglvsMgl_mDN(A9)&SN.markers.csv" )

```


#heatmap cluster genes

```{r}
library(pheatmap)
library(RColorBrewer)

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}

fix(Comb3SNQC.markers)

top100c <- head(rownames(Comb3SNQC.markers), 100)
top500c <- head(rownames(Comb3SNQC.markers), 500)

genes_clustergenes <- subset(Comb3SNQC, features = top100c )
genes_clustergenes1 <- subset(Comb3SNQC, features = top500c)
genes_clustergenes2 <- subset(Comb3SNQC, features = rownames(Comb3SNQC.markers) )

genes_expr_cluster <- AverageExpression(genes_clustergenes)$RNA
genes_expr_cluster1 <- AverageExpression(genes_clustergenes1)$RNA
genes_expr_cluster2 <- AverageExpression(genes_clustergenes2)$RNA


NormalisedData_Zscore_3 <- t(apply(as.matrix(genes_expr_cluster),1,Z_Normalize))
NormalisedData_Zscore_4 <- t(apply(as.matrix(genes_expr_cluster1),1,Z_Normalize))
NormalisedData_Zscore_5 <- t(apply(as.matrix(genes_expr_cluster2),1,Z_Normalize))

is.na(NormalisedData_Zscore_5) %>% table()
NormalisedData_Zscore_5<- na.omit(NormalisedData_Zscore_5)
is.na(NormalisedData_Zscore_5) %>% table()

is.na(NormalisedData_Zscore_4) %>% table()
NormalisedData_Zscore_4<- na.omit(NormalisedData_Zscore_4)
is.na(NormalisedData_Zscore_4) %>% table()

is.na(NormalisedData_Zscore_3) %>% table()
NormalisedData_Zscore_3<- na.omit(NormalisedData_Zscore_3)
is.na(NormalisedData_Zscore_3) %>% table()

pheatmap(NormalisedData_Zscore_3, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 10, main='Average expression of top 100 cluster genes', filename= "heatmapallgensCLUSTER1.pdf")
pheatmap(NormalisedData_Zscore_4, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = F, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 1, main='Average expression of top 500 cluster genes', filename= "heatmapallgensCLUSTER5.pdf")

pheatmap(NormalisedData_Zscore_5, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = F, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 0.1, main='Average expression of cluster defining genes', filename= "heatmapallgensCLUSTERall.pdf")



```
--------------------------------------------------------------------------------------------------------------------------------------

#MICROGLIA


```{r}
# Microglia resting
VlnPlot(Comb3SNQC, features = c("AIF1", "CD33","CD84","MEF2A","SPI1" ,"P2RY12", "CX3CR1", "CSF1R", "LAG3","TMEM119", "ITGAM", "CSFR1","TGFBR1", "SALL1", "SMAD3", " "), slot = "counts", log = TRUE)
# Microglia active
VlnPlot(Comb3SNQC, features = c( "LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2", "", "", " "), slot = "counts", log = TRUE)

p1 <- VlnPlot(Comb3SNQC, features = "AIF1", group.by = "Model", y.max = 6) +
  theme(axis.title.x = element_blank()) +
  ggpubr::stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 6, label = "p.signif")

p2 <- cowplot::ggdraw(cowplot::add_sub(p1, "Wilcox-test, ****p<=0.0001, ***p<=0.001, **p<=0.01, *p<=0.05, ns=p>0.05", size=9))
p2

#all cells - yes vs no
p1 <- VlnPlot(Comb3SNQC, features = "AIF1", group.by = "Mgl", y.max = 6) +
  theme(axis.title.x = element_blank()) +
  ggpubr::stat_compare_means(comparisons = list(c("YES", "NO")), method = "wilcox.test",label.y = 5, label = "p.signif")
p2 <- cowplot::ggdraw(cowplot::add_sub(p1, "Wilcox-test, ****p<=0.0001, ***p<=0.001, **p<=0.01, *p<=0.05, ns=p>0.05", size=9))
p2

# create microglial subset OR split using CLUSTER _MODEL does not help - one sample wilcox test needed
Microglia <- subset(Comb3SNQC, idents = "MGL")
head(Microglia@meta.data, 5)

 #only Microglia  - problem no reference group for hat gene
p1 <- VlnPlot(Microglia, features = "AIF1", group.by = "Model", y.max = 6) +
  theme(axis.title.x = element_blank()) +
  ggpubr::stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 6, label = "p.signif")

p2 <- cowplot::ggdraw(cowplot::add_sub(p1, "Wilcox-test, ****p<=0.0001, ***p<=0.001, **p<=0.01, *p<=0.05, ns=p>0.05", size=9))
p2

# only microgla - yes vs no - one sample not workng yet
p1 <- VlnPlot(Microglia, features = "AIF1", slot = "data", group.by = "Mgl", y.max = 6) +
  theme(axis.title.x = element_blank()) +
   ggpubr::stat_compare_means(comparisons = list(c("YES", "NO")), method = "wilcox.test" ,ref.group = "0", label.y = 5, label = "p.signif")
p2 <- cowplot::ggdraw(cowplot::add_sub(p1, "Wilcox-test, ****p<=0.0001, ***p<=0.001, **p<=0.01, *p<=0.05, ns=p>0.05", size=9))
p2


# Microglia resting
VlnPlot(Comb3SNQC, features = c("AIF1", "CD33","CD84","MEF2A","SPI1" , "CSF1R", "TGFBR1", "SALL1"), slot = "counts", log = TRUE, group.by = "Model")

# Microglia active
VlnPlot(Comb3SNQC, features = c( "LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2"), slot = "counts", log=TRUE, group.by = "Model")


# Microglia resting
DotPlot(Comb3SNQC, features = c("AIF1", "CD33","CD84","MEF2A","SPI1" ,"P2RY12", "CX3CR1", "CSF1R", "LAG3","TMEM119", "ITGAM", "CSFR1","TGFBR1", "SALL1", "SMAD3", " "))
# Microglia active
DotPlot(Comb3SNQC, features = c( "LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2"))

DotPlot(Comb3SNQC, features = c("APOE","AIF1", "CD33","CD84","MEF2A","SPI1" ,"P2RY12", "CX3CR1", "CSF1R", "LAG3","TMEM119", "ITGAM", "CSFR1","TGFBR1", "SALL1", "SMAD3", "LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2"), group.by = "Mgl")



featuresGenesH = c("SERPINE2", "GPR56", "SYNGR1", "P2RY13", "CX3CR1", "CXXC5", "OLFML3", "GPR34")
featuresGenesM1 = c("TGM1", "TLR6", "TNF", "CXCL16", "CD14", "ITGA9", "PPP1R15A", "IGF2", "CCL2", "SOCS3")
featuresGenesM2=c("GAS6", "CKB", "LGMN", "ALOX12B", "MRC1", "L7C4S", "KHDRBS3", "CCND1", "TIMP2", "MAFB", "CSF1R", "PTMS", "IGF1", "CCL17", "IL10", "KLF4", "SLC30A4", "SCAF1", "CSF1", "CXCR1", "AK1", "RAB3IL1" )


DotPlot(Comb3SNQC, features = featuresGenesH )
DotPlot(Comb3SNQC, features =featuresGenesM1)
DotPlot(Comb3SNQC, features =featuresGenesM2)

# do heatmap, and get signficance
```

```{r}
#featuresGenes = c("AIF1", "CD33","CD84","MEF2A","SPI1" ,"P2RY12", "CX3CR1", "CSF1R", "LAG3","TMEM119", "ITGAM", "CSFR1","TGFBR1", "SALL1", "SMAD3", "LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2")

#featuresGenes = c("AIF1", "CD33","CD84","MEF2A","SPI1" ,  "CSF1R",  "ITGAM", "CSFR1","TGFBR1",  "SMAD3", "LGALS3","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL")


featuresGenesH = c("SERPINE2", "GPR56", "SYNGR1", "P2RY13", "CX3CR1", "CXXC5", "OLFML3", "GPR34")
featuresGenesM1 = c("TGM1", "TLR6", "TNF", "CXCL16", "CD14", "ITGA9", "PPP1R15A", "IGF2", "CCL2", "SOCS3")
featuresGenesM2=c("GAS6", "CKB", "LGMN", "ALOX12B", "MRC1", "L7C4S", "KHDRBS3", "CCND1", "TIMP2", "MAFB", "CSF1R", "PTMS", "IGF1", "CCL17", "IL10", "KLF4", "SLC30A4", "SCAF1", "CSF1", "CXCR1", "AK1", "RAB3IL1", "APOE" )

micro=read.csv("micro.raw.data_exp.csv", header =T)
fix(micro)
#= rownames(micro

rownames(micro) =micro[,1]
micro=micro[,-1]
microH=micro[featuresGenesH,]
microM1=micro[featuresGenesM1,]
microM2=micro[featuresGenesM2,]


is.na(microH) %>% table()
microH<- na.omit(microH)
is.na(microH) %>% table()

is.na(microM1) %>% table()
microM1<- na.omit(microM1)
is.na(microM1) %>% table()

is.na(microM2) %>% table()
microM2<- na.omit(microM2)
is.na(microM2) %>% table()

pheatmap(microH, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE_ACTIVEVSINACTH.pdf")

pheatmap(microM1, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE_ACTIVEVSINACTM1.pdf")

pheatmap(microM2, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE_ACTIVEVSINACTM2.pdf")
```


```{r}
featuresGenes = c("SERPINE2", "GPR56", "SYNGR1", "P2RY13", "CX3CR1", "CXXC5", "OLFML3", "GPR34","TGM1", "TLR6", "TNF", "CXCL16", "CD14", "ITGA9", "PPP1R15A", "IGF2", "CCL2", "SOCS3","GAS6", "CKB", "LGMN", "ALOX12B", "MRC1", "L7C4S", "KHDRBS3", "CCND1", "TIMP2", "MAFB", "CSF1R", "PTMS", "IGF1", "CCL17", "IL10", "KLF4", "SLC30A4", "SCAF1", "CSF1", "CXCR1", "AK1", "RAB3IL1","AIF1", "CD33","CD84","MEF2A","SPI1" ,"P2RY12", "CX3CR1", "CSF1R", "LAG3","TMEM119", "ITGAM", "CSFR1","TGFBR1", "SALL1", "SMAD3", "LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2", "APOE", "CD68", "CD63" )

#featuresGenes = c("SERPINE2", "GPR56", "SYNGR1", "", "", "", "", "GPR34","", "TLR6", "", "CXCL16", "CD14", "", "PPP1R15A", "", "CCL2", "SOCS3","GAS6", "", "LGMN", "", "MRC1", "L7C4S", "", "CCND1", "TIMP2", "MAFB", "CSF1R", "", "IGF1", "CCL17", "IL10", "", "SLC30A4", "", "CSF1", "SPP1", "AK1", "" )

micro=read.csv("micro.raw.data_exp.csv", header =T)
fix(micro)
#= rownames(micro

rownames(micro) =micro[,1]
micro=micro[,-1]
micro=micro[featuresGenes,]

is.na(micro) %>% table()
micro<- na.omit(micro)
is.na(micro) %>% table()

pheatmap(micro, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE_ACTIVEVSINACt_allselect cells.pdf")
```
```{r}

#
featuresGenes = c("SERPINE2", "GPR56", "","GPR34","", "TLR6",  "CXCL16", "CD14", "", "PPP1R15A", "", "CCL2",  "LGMN", "APOE", "L7C4S", "CCND1", "MAFB", "CSF1R", "IGF1", "", "IL10", "", "",  "SPP1", "", "","CD68", "CD63", "TGFBR1",
"MEF2A", 
"ITGAM",
"LGALS3",
"MRC1", "TIMP2",  "CD200R", "HLA-DRB", "TGFB", "CD40", "CD74", "CD86", "CD163", "CD16", "CD64", "", "CD150", "", "IL4R", "CD80", "", "YM1", "FIZZ1", "", "", "IL12", "IL23", "AIF1", "HGMB1", "", "", "TLR4", "SIRP1A", "HMOX1", "SPI1", "HLA-B", "HLA-C", "HLA-A", "VEGFA", "MMP9", "TGM2", "PPARG", "CCL24", "CCL23" )

micro=read.csv("micro.raw.data_exp.csv", header =T)
fix(micro)
#= rownames(mic 

rownames(micro) =micro[,1]
micro=micro[,-1]
micro=micro[featuresGenes,]

is.na(micro) %>% table()
micro<- na.omit(micro)
is.na(micro) %>% table()

pheatmap(micro, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE_ACTIVEVSINACt_allselect.pdf")
```

#genes
#homeostatic#"SERPINE2", "GPR56", "SYNGR1", "P2RY13", "CX3CR1", "CXXC5", "OLFML3", "GPR34"
#M1#"TGM1", "TLR6", "TNF", "CXCL16", "CD14", "ITGA9", "PPP1R15A", "IGF2", "CCL2", "SOCS3"
#M2 signature#"GAS6", "CKB", "LGMN", "ALOX12B", "MRC1", "L7C4S", "KHDRBS3", "CCND1", "TIMP2", "MAFB", "CSF1R", "PTMS", "IGF1", "CCL17", "IL10", "KLF4", "SLC30A4", #"SCAF1", "CSF1", "CXCR1", "AK1", "RAB3IL1" 


Count cells expressing one gene
```{r}
head(Comb3SNQC@meta.data, 5)

#number of cells
sum(GetAssayData(object = Comb3SNQC, slot = "data")["AIF1",]>0)
#percentage
sum(GetAssayData(object = Comb3SNQC, slot = "data")["AIF1",]>0)/nrow(Comb3SNQC@meta.data)
                                                                     
#count cells per group
#Comb3SNQC@active.ident
cell.num = table(Comb3SNQC@active.ident)    

sum(cell.num)

cell.perc= cell.num/sum(cell.num)*100

  
# count celss per group in subset Mgl_K7

COUNT= subset(Comb3SNQC)
Idents(COUNT)= "Model"
Count1<- subset(COUNT, idents = "Mgl_K7")
Idents(Count1) <- "seurat_clusters"
head(Count1@meta.data, 5)
cell.num.model = table(Count1@active.ident)  



```

```{r}
library(pheatmap)
library(RColorBrewer)

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}

genes_micro <- subset(Comb3SNQC, features =  c("AIF1", "CD33","CD84","MEF2A","SPI1" , "CSF1R", "TGFBR1","LGALS3","AXL","ITGAX","SPP1" ,"CCL2", "CSF1", "LPL", "TREM2"))

head(genes_micro@meta.data, 5)
genes_expr_micro <- AverageExpression(genes_micro)$RNA


NormalisedData_Zscore_1 <- t(apply(as.matrix(genes_expr_micro),1,Z_Normalize))

pheatmap(NormalisedData_Zscore_1, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 20, main='Average expression of microglial genes', filename= "heatmapMGLCLUSTER.pdf")

```


```{r}
library(pheatmap)
library(RColorBrewer)

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}

fix(Comb3SNQC.markers)
rn=rownames(Comb3SNQC.markers)
MGLgenes=rn[4504:4183]

#change MGL to 8 if levels not changed or vis versa
mgl= filter(Comb3SNQC.markers, cluster == "MGL")
top100x <- head(rownames(mgl), 100)

genes_MGLgenes <- subset(Comb3SNQC, features = top100x )

genes_expr_mgl <- AverageExpression(genes_MGLgenes)$RNA


NormalisedData_Zscore_2 <- t(apply(as.matrix(genes_expr_mgl),1,Z_Normalize))

pheatmap(NormalisedData_Zscore_2, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 10, main='Average expression of microglial genes', filename= "heatmapMGLallgensCLUSTER.pdf")

```


#get expression values
```{r}

# How can I extract expression matrix for all NK cells (perhaps, to load into another package)
all.raw.data <- as.matrix(GetAssayData(Comb3SNQC, slot = "counts"))

micro.raw.data <- as.matrix(GetAssayData(Comb3SNQC, slot = "counts")[, WhichCells(Comb3SNQC, ident = "MGL")])

write.csv(all.raw.data, "all.raw.data.csv" )
write.csv(micro.raw.data, "micro.raw.data.csv" )

all.raw.data_exp <- as.matrix(GetAssayData(Comb3SNQC, slot = "scale.data"))
write.csv(all.raw.data_exp, "all.raw.data_exp.csv" )

all.raw.data1 <- as.matrix(GetAssayData(Comb3SNQC, slot = "data"))
write.csv(all.raw.data1, "all.raw.data_exp.csv" )

micro.raw.data_exp <- as.matrix(GetAssayData(Comb3SNQC, slot = "data")[, WhichCells(Comb3SNQC, ident = "MGL")])
write.csv(micro.raw.data_exp, "micro.raw.data_exp.csv" )

#new=micro.raw.data_exp.loc[(micro.raw.data_exp!=0).any(1)]

#microno0=filter_all(micro.raw.data_exp, any_vars(. != 0))
#write.csv(microno0, "micro.raw.data_exp_0removed.csv" )



```

```{r}
micro=read.csv("micro.raw.data_exp.csv", header =T)

#fix(micro)
#= rownames(micro
rownames(micro)=micro[,1]
micro=micro[,-1]
micro<- as.matrix(micro)
micro <- micro [which(rowSums(micro) > 0), ]  
micro= as.data.frame(micro)

is.na(micro) %>% table()
micro<- na.omit(micro)
is.na(micro) %>% table()

pheatmap(micro, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 60, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE.pdf")
```


```{r}
cluster.markers=read.csv("ClusterMarkers_Comb3SNQC(dim20).csv")

mgl= filter(cluster.markers, cluster == "MGL")
rownames(mgl)=mgl[,1]
top100m <- head(rownames(mgl), 100)
micro=read.csv("micro.raw.data_exp.csv", header =T)

fix(micro)
#= rownames(micro

rownames(micro) =micro[,1]
micro=micro[,-1]
micro=micro[top100m,]

pheatmap(micro, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 90,  fontsize_col = 14, cellwidth = 20, cellheight = 10, main='Microglial cells', filename= "heatmapMicroglia_CELL_GENE_top100.pdf")

```

--------------------------------------------------------------------------------------------------------------------------------------
#CYTOKINES

```{r}
VlnPlot(Comb3SNQC, features = c("IL6","IL3", "IL1A", "IL1B", "IL12B", "IL7", "IL10", "IFNG", "IF1", "TNF", "CXCL1", "CXCL2", "CX3CL1", "CXCL10", "CXCL8", "CCL2", "CCL19", "CCL3", "CCL4","IL16", "IL18", "IL27", "OSM", "LTBR", "TGFB1", "TNFSF8", "TNFSF14", "CCR1", "CCR2", "CCR5", "CCL2", "CCL4", "CCL8", "CCL20", "CCL22", "CXCR2", "CXCR4", "CXCL8", "CXCL12", "CXCL16", "CX3CR1"), slot = "counts", log = TRUE, group.by = "Model")


```


#statistics
```{r}
VlnPlot(Comb3SNQC, features = c("IL6"),  log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL3"), log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL1A"),  log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL1B"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL12B"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL7"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL10"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IFNG"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL2"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CX3CL1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL10"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL8"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL2"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL19"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL3"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL4"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")



VlnPlot(Comb3SNQC, features = c("IL6"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL3"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL1A"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL1B"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL12B"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL7"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IL10"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("IFNG"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL2"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CX3CL1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL10"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CXCL8"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL2"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL19"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL3"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("Mgl_K7_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CCL4"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
```

# Other plots
```{r}
DotPlot(Comb3SNQC, features = c("IL6","IL3", "IL1A", "IL1B", "IL12B", "IL7", "IL10", "IFNG", "IF1", "TNF", "CXCL1", "CXCL2", "CX3CL1", "CXCL10", "CXCL8", "CCL2", "CCL19", "CCL3", "CCL4")) + RotatedAxis()

markers.to.plot <- c("IL6","IL3", "IL1A", "IL1B", "IL12B", "IL7", "IL10", "IFNG", "IF1", "TNF", "CXCL1", "CXCL2", "CX3CL1", "CXCL10", "CXCL8", "CCL2", "CCL19", "CCL3", "CCL4")

DotPlot(Comb3SNQC, features = markers.to.plot, cols = c("blue", "red"), dot.scale = 8, split.by = "Mgl") + 
    RotatedAxis()

DoHeatmap(Comb3SNQC, features = c("IL6","IL3", "IL1A", "IL1B", "IL12B", "IL7", "IL10", "IFNG", "IF1", "TNF", "CXCL1", "CXCL2", "CX3CL1", "CXCL10", "CXCL8", "CCL2", "CCL19", "CCL3", "CCL4"), group.by = "Model")

RidgePlot(Comb3SNQC, features = c("CCL2"))

FeaturePlot(Comb3SNQC, features = c("IL6", "IL1A", "IL1B", "IL7", "IL10",  "TNF", "CXCL1", "CXCL2", "CX3CL1",  "CXCL8", "CCL2", "CCL3", "CCL4"), max.cutoff = 3, 
    cols = c("grey", "red"))


FeaturePlot(Microglia, features = c("IL6", "IL1A", "IL1B", "IL7", "IL10",  "TNF", "CXCL1", "CXCL2", "CX3CL1",  "CXCL8", "CCL2", "CCL3", "CCL4"), max.cutoff = 3, 
    cols = c("grey", "red"))

```

#Heatmaps
```{r}
library(pheatmap)
library(RColorBrewer)

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}

genes_cytok <- subset(Comb3SNQC, features =  c("IL6", "IL1A", "IL1B",  "IL7", "IL10", "TNF", "CXCL1", "CXCL2", "CX3CL1",  "CXCL8", "CCL2",  "CCL3", "CCL4"))

head(genes_cytok@meta.data, 5)
genes_variable_expr <- AverageExpression(genes_cytok)$RNA


NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr),1,Z_Normalize))

pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 20, main='Average expression of cytokines', filename= "heatmapCYTOKCLUSTER.pdf")

```

```{r}

Z_Normalize <- function(x){return((x-mean(x))/(sd(x)))}

#genes_cytok <- subset(Comb3SNQC, features =  c("IL6", "IL1A", "IL1B",  "IL7", "IL10", "TNF", "CXCL1", "CXCL2", "CX3CL1",  "CXCL8", "CCL2",  "CCL3", "CCL4","IL16", "IL18",  "OSM", "LTBR", "TGFB1",  "TNFSF14", "CCR1",  "CCR5", "CCL2", "CCL4", "CCL8", "CCL20", "CCL22", "CXCR4", "CXCL8", "CXCL12", "CXCL16"))

genes_cytok <- subset(Comb3SNQC, features =  c( "IL1A", "IL1B",  "IL10", "TNF", "CXCL1", "CXCL2", "CXCL8", "CCL2",  "CCL3", "CCL4","IL16", "IL18", "LTBR", "TGFB1",  "CCR1",  "CCR5", "CCL2", "CCL4", "CCL8", "CCL22", "CXCR4", "CXCL8", "CXCL16"))

head(genes_cytok@meta.data, 5)
genes_variable_expr <- AverageExpression(genes_cytok)$RNA


NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr),1,Z_Normalize))

pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 20, main='Average expression of cyto- and chemokines', filename= "heatmapCYTO&CHEMO.pdf")


```

```{r}

genes_cytok <- subset(Ident_model, features =  c("IL6", "IL1A", "IL1B",  "IL7", "IL10", "TNF", "CXCL1", "CXCL2", "CX3CL1",  "CXCL8", "CCL2",  "CCL3", "CCL4"))

head(genes_cytok@meta.data, 5)
genes_variable_expr <- AverageExpression(genes_cytok)$RNA


NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr),1,Z_Normalize))

pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 20, main='Average expression of cytokines', filename= "heatmapCYTOKMgl.pdf")

```


```{r}

genes_cytok <- subset(Ident_Mgl, features =  c("IL6", "IL1A", "IL1B",  "IL7", "IL10", "TNF", "CXCL1", "CXCL2", "CX3CL1",  "CXCL8", "CCL2",  "CCL3", "CCL4"))

head(genes_cytok@meta.data, 5)
genes_variable_expr <- AverageExpression(genes_cytok)$RNA


NormalisedData_Zscore <- t(apply(as.matrix(genes_variable_expr),1,Z_Normalize))

pheatmap(NormalisedData_Zscore, colorRampPalette(rev(brewer.pal(n = 5, name =
  "RdYlBu")))(100), show_rownames = T, angle_col = 45,  fontsize_col = 14, cellwidth = 20, cellheight = 20, main='Average expression of cytokines', filename= "heatmapCYTOKMgl.pdf")

```

--------------------------------------------------------------------------------------------------------------------------------------

#CELL DEATH
```{r}
DotPlot(Comb3SNQC, features = c("BCL2", "BCL10", "BAX", "BAD", "BAK1", "CASP3", "CASP8", "CASP6", "FADD", "CYCS", "CASP1"),  group.by = "CLUSTER_Mgl")
```


```{r}
VlnPlot(Comb3SNQC, features = c("BCL2"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BCL10"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BAX"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BAD"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BAK1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CASP3"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CASP8"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CASP6"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("FADD"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CYCS"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("MOs", "pMGL-MOs")), method = "wilcox.test", label.y = 5, label = "p.signif")


VlnPlot(Comb3SNQC, features = c("BCL2"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BCL10"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BAX"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BAD"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BAK1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CASP3"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CASP8"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CASP6"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("FADD"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("CYCS"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")

```
--------------------------------------------------------------------------------------------------------------------------------------
#PHAGOCYTOSIS
Functional selection of phagocytosis-promoting genes: cell sorting-based selection

```{r}

VlnPlot(Comb3SNQC, features = c("EIF5A", "MEG3", "TUBB5", "SPARCL1", "UCHL1", "BSG", "UBE2V1",  "PARM1"),   log = TRUE, split.by = "Model")


VlnPlot(Comb3SNQC, features = c("EIF5A"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("MEG3"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("TUBB"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("UCHL1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BSG"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c( "UBE2V1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("PARM1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("SPARCL1"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")

VlnPlot(Comb3SNQC, features = c("EIF5A"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("MEG3"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("TUBB"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("UCHL1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("BSG"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c( "UBE2V1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("PARM1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("SPARCL1"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")

DoHeatmap(Comb3SNQC, features = c("EIF5A", "MEG3", "TUBB5", "SPARCL1", "UCHL1", "BSG", "UBE2V1",  "PARM1"))

```

#Maturity

#problem K7 has alot less neurons  - technical issue?
```{r}
VlnPlot(Comb3SNQC, features = c("TH"), slot= "data",  log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("TH"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("TH"),   log = TRUE, split.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")


VlnPlot(Comb3SNQC, features = c("FOXA2"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("FOXA2"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")


VlnPlot(Comb3SNQC, features = c("TUBB"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("TUBB"),   log = TRUE, split.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("TUBB"),   log = TRUE, group.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 5, label = "p.signif")


VlnPlot(Comb3SNQC, features = c("MAP2"),   log = TRUE, group.by = "Model", y.max = 1)+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif", y.max = 1)+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("MAP2"),   log = TRUE, group.by = "Mgl", y.max = 3)+
  theme(axis.title.x = element_blank()) +
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 1.5, label = "p.signif")

VlnPlot(Comb3SNQC, features = c("SYP"),   log = TRUE, group.by = "Mgl", y.max = 3, pt.size = 0)+
  theme(axis.title.x = element_blank()) +
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
     stat_summary(fun = mean, geom='point', size = 10, colour = "black", shape = 95)

VlnPlot(Comb3SNQC, features = c("SYP"),   log = TRUE, split.by = "Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")

VlnPlot(Comb3SNQC, features = c("MAPT"),   log = TRUE, split.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("MAPT"),   log = TRUE, group.by = "Mgl", y.max = 3)+
  theme(axis.title.x = element_blank()) +
  ggpubr::stat_compare_means(comparisons = list (c("YES", "NO")), method = "wilcox.test", label.y = 1.5, label = "p.signif")
VlnPlot(Comb3SNQC, features = c("MAPT"),   log = TRUE, group.by = "Model")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_K7")), method = "wilcox.test", label.y = 5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("No_Mgl", "Mgl_163")), method = "wilcox.test", label.y = 5, label = "p.signif")

DoHeatmap(Comb3SNQC, features = c("MAP2", "TUBB"))
DoHeatmap(Comb3SNQC, features = c("MAP2", "TUBB"), group.by="Mgl")


VlnPlot(Comb3SNQC, features = c("MAPT"),   log=T, group.by = "CLUSTER_Mgl")+
  ggpubr::stat_compare_means(comparisons = list (c("6_NO", "6_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("4_NO", "4_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("3_NO", "3_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("2_NO", "2_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("1_NO", "1_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")

  
  VlnPlot(Comb3SNQC, features = c("MAPT"),   log=T, group.by = "Mgl")+
  geom_signif(comparisons = list(c("NO", "YES")), test='wilcox.test',
                  vjust=0, size=0.3, textsize=3, map_signif_level=c("***"=0.001, "**"=0.01, "*"=0.05), y_position = 0.55)

  
  VlnPlot(Comb3SNQC, features = c("SYP"),   log=T, group.by = "CLUSTER_Mgl",pt.size = 0)+
  ggpubr::stat_compare_means(comparisons = list (c("7_NO", "7_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("6_NO", "6_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("5_NO", "5_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("4_NO", "4_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("3_NO", "3_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("2_NO", "2_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("1_NO", "1_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("0_NO", "0_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
     stat_summary(fun.y = mean, geom='point', size = 10, colour = "black", shape = 95)

  VlnPlot(Comb3SNQC, features = c("TUBB"),   log=T, group.by = "CLUSTER_Mgl", pt.size = 0)+
  ggpubr::stat_compare_means(comparisons = list (c("7_NO", "7_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("6_NO", "6_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("5_NO", "5_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("4_NO", "4_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("3_NO", "3_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("2_NO", "2_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("1_NO", "1_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("0_NO", "0_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
     stat_summary(fun.y = mean, geom='point', size = 10, colour = "black", shape = 95)

   VlnPlot(Comb3SNQC, features = c("MAP2"),   log=T, group.by = "CLUSTER_Mgl", pt.size = 0)+
  ggpubr::stat_compare_means(comparisons = list (c("7_NO", "7_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("6_NO", "6_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("5_NO", "5_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("4_NO", "4_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("3_NO", "3_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("2_NO", "2_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("1_NO", "1_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("0_NO", "0_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
     stat_summary(fun.y = mean, geom='point', size = 10, colour = "black", shape = 95)

    VlnPlot(Comb3SNQC, features = c("MAP2"),   log=T, group.by = "CLUSTER_Mgl", pt.size = 0)+
  ggpubr::stat_compare_means(comparisons = list (c("7_NO", "7_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("6_NO", "6_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("5_NO", "5_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("4_NO", "4_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("3_NO", "3_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("2_NO", "2_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("1_NO", "1_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
  ggpubr::stat_compare_means(comparisons = list (c("0_NO", "0_YES")), method = "wilcox.test", label.y = 1.5, label = "p.signif")+
     stat_summary(fun.y = median, geom='point', size = 10, colour = "black", shape = 95)
```

# FIL GRAPHS


Microglia
```{r}
library(grid)

Ident_micro<- subset(Microglia)
wilcox.test(Ident_micro@assays$RNA@data['AIF1',], mu=0)
grob <- grobTree(textGrob("**", x=0.49,  y=0.98, hjust=0, gp=gpar(col="black", fontsize=13)))

Idents(Ident_micro)   = "Mgl"
Ident_micro@meta.data %>%
  mutate(expression = Ident_micro@assays$RNA@data['AIF1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "AIF1") +annotation_custom(grob)




```

Cell death
```{r}
#"BCL2", "BCL10", "BAX", "BAD", "BAK1", "CASP3", "CASP8", "CASP6", "FADD", "CYCS"

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
bcl=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BCL2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BCL2")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
bcl=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CYBB',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CYBB")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BCL10',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BCL10")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"

bax=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BAX',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BAX")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
bad=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BAD',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BAD")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"

bak=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BAK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BAK1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
casp3=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASP3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASP3")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
casp8=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASP8',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASP8")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
casp9=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASP9',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASP9")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASP6',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASP6")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
cyc=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CYCS',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CYCS")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
fadd=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['FADD',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "FADD")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
casp1=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASP1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
pyk=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PYCARD',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PYCARD")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
inf=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NLRP3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NLRP3")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
lc3=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data["MAP1LC3A",]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "LC3")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
p62=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data["SQSTM1",]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "p62")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data["NLRP3",]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NLRP3")


mlkl=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data["MLKL",]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MLKL")
```


```{r}
DotPlot(Comb3SNQC, features = c("BAK1", "BAX", "CASP1" , "CASP3", "CASP8", "CASP9", "FADD", "CYCS", "MLKL", "PYCARD", "NLRP3", "ATF6", "BCL2"), group.by  = "CELLID_Mgl" )+
RotatedAxis()
```

Count cells expressing one gene
```{r}
head(Comb3SNQC@meta.data, 5)

#number of cells
sum(GetAssayData(object = Comb3SNQC, slot = "data")["CASP3",]>0)
#percentage
sum(GetAssayData(object = Comb3SNQC, slot = "data")["CASP3",]>0)/nrow(Comb3SNQC@meta.data)
                                                                     
#count cells per group
#Comb3SNQC@active.ident
#"BCL2", "BCL10", "BAX", "BAD", "BAK1", "CASP3", "CASP8", "CASP6", "FADD", "CYCS"

sum(GetAssayData(object = Comb3SNQC, slot = "data")["BCL2",]>0)/nrow(Comb3SNQC@meta.data)
sum(GetAssayData(object = Comb3SNQC, slot = "data")["BCL10",]>0)/nrow(Comb3SNQC@meta.data)
sum(GetAssayData(object = Comb3SNQC, slot = "data")["BAX",]>0)/nrow(Comb3SNQC@meta.data)
sum(GetAssayData(object = Comb3SNQC, slot = "data")["BAD",]>0)/nrow(Comb3SNQC@meta.data)
sum(GetAssayData(object = Comb3SNQC, slot = "data")["CYCS",]>0)/nrow(Comb3SNQC@meta.data)
sum(GetAssayData(object = Comb3SNQC, slot = "data")["CASP6",]>0)/nrow(Comb3SNQC@meta.data)

COUNTCD= subset(Comb3SNQC)
Idents(COUNTCD)= "Mgl"
CountCD<- subset(COUNTCD, idents = "MOs")
sum(GetAssayData(object = CountCD, slot = "data")["CASP3",]>0)/nrow(Comb3SNQC@meta.data)

COUNTCD= subset(Comb3SNQC)
Idents(COUNTCD)= "Mgl"
CountCD<- subset(COUNTCD, idents = "pMGL-MOs")
sum(GetAssayData(object = CountCD, slot = "data")["CASP3",]>0)/nrow(Comb3SNQC@meta.data)

 Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASP3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASP3") 

```

```{r}
Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['LRRK2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "LRRK2")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PINK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PINK1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SNCA',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SNCA")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PARK7',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DJ1")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PRKN',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PARKIN")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GBA',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "GBA")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NFATC2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NFATC2")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SRR',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SRR")

```



Cell stress
```{r}

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PGK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PGK1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ARCN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ARCN1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GORASP2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "GORASP2")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TFAM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TFAM")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HMGB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HMGB1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HMGN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HMGN1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SAP130',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SAP130")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
calr=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CALR',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CALR")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
ppia=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PPIA',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PPIA")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['FN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Fibronectin")



Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['IL33',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "IL33")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSPA2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSP70")



Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSPA5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSPA5")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['S100A4',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "S100A4")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['S100A5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "S100A5")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['S100A8',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "S100A8")



Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['S100A9',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "S100A9")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['S100A11',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "S100A11")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['LGALS1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "LGALS1")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NLRP3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NLRP3")




```

```{r}
DotPlot(Comb3SNQC, features = c("HSP70", "IL33", "S100A8" , "S100A4", "NLRP3", "LGALS1", "S100A11", "S100A9", "S100A5", "HSPA5", "FIB", "PPIA", "CALR", "SAP130", "HMGN1", "HMGB1", "TFAM"), group.by  = "CELLID_Mgl" )+
RotatedAxis()
```

#oxidative stress
```{r}
DotPlot(Comb3SNQC, features = c("NCF1", "CYBA", "NOXO1" , "NOX1", "NOXA1", "CYBB", "NOS2", "NOX3", "NOX5", "XDH", "MAOA", "NFIX", "CYP1A1", "JUNB", "FOS", "NFE2L2", "NFKB1", "SP1", "MAPK10", "MAPK14", "CAT", "TXN2", "TXNRD1", "TXNRD2", "GCLC", "MT1X", "HMOX1", "GPX1", "GPX3", "NQO1", "UGT1A6", "GSR", "GSTT2", "MGST1", "SOD1", "SOD2", "SOD3"), group.by  = "CELLID_Mgl" )+
RotatedAxis()

```

Phagosome
```{r}


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PFN2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Profilin2")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PFN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Profilin1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CFL1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Cofilin")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CSRP3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CSRP3")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MRC2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MRC2")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSPA5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSPA5")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSPA2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSPA2")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ELMO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ELMO1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ELMO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ELMO1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['FN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "FN1")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-C")

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-B")


```


```{r}

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TH',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TH")

```


Maturity

```{r}


z=c("
 RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1")

DotPlot(Comb3SNQC, features = c("RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1"), split.by = "Mgl") +
guides(color = guide_colorbar(title = 'Average Expression'))

DotPlot(Comb3SNQC, features = c("RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1"))

DotPlot(Comb3SNQC, features = c("RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1"), group.by  = "Mgl")



DotPlot(Comb3SNQC,features = c("RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1"), cols = c("blue"), dot.scale = 8) + RotatedAxis() +
scale_colour_gradient(low = "white", high = "blue") +
guides(color = guide_colorbar(title = 'Average Expression'))

DotPlot(Comb3SNQC, features = c("RNF157", "SPRYD7", "MIRAS" , "TUBB2A", "SKP1", "GNAI1", "MRAS", "ATP1A3", "ATP5J", "MAGED1", "ARL2", "MCFD2", "MORF4L2", "NRSN2", "NAP1L3", "NGRN", "OLFM1", "DKK3", "CCDC136", "COX6C", "HSP90AB1", "CALM2", "ATP1B1", "UQCRB","COX4I1", "PSMB5", "FXYD7", "RTN1", "C14ORF2", "SEC62", "COX7C", "CNTN1", "FAIM2", "SLC48A1", "RAB3B", "NPTXR","PDGFA", "NDUFC2", "BEX2", "UCHL1"), group.by  = "CELLID_Mgl" )+
RotatedAxis()

```


```{r}
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BEX2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BEX2")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NDUFC2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NDUFC2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PDGFA',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PDGFA")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NPTXR',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NPTXR")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['RAB3B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RAB3B")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SLC48A1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SLC48A1")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['FAIM2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "FAIM2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CNTN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CNTN1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['COX7C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "COX7C")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SEC62',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SEC62")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATP5MPL',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "C14ORF2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['RTN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RTN1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['FXYD7',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "FXYD7")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PSMB5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PSMB5")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['COX4I1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "COX4I1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['UQCRB',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "UQCRB")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATP1B1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ATP1B1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CALM2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CALM2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSP90AB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSP90AB1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['COX6C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "COX6C")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CCDC136',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CCDC136")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DKK3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DKK3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['OLFM1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "OLFM1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NGRN',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NGRN")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NAP1L3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NAP1L3")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NRSN2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NRSN2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MORF4L2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MORF4L2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MCFD2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MCFD2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ARL2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ARL2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MAGED1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MAGED1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATP5PF',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ATP5J")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATP1A3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ATP1A3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MRAS',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MRAS")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MRAS',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MRAS")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SPRYD7',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SPRYD7")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['RNF157',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RNF157")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TUBB2A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TUBB2A")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SKP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SKP1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['UCHL1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "UCHL1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GNAI1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "GNAI1")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MAPT',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TAU")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TUBB3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TUJ1")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MAP2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
    theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MAP2")


Ident_model<- subset(Comb3SNQC)
Idents(Ident_model)   = "Model"

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['MAP2',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "MAP2")




```

SYNAPSES
```{r}
DotPlot(Comb3SNQC, features = c("GPHN", "PDK1", "MECP2", "SNCA", "EFNB3", "EFNB1", "NLGN1", 
 "NTN1","DCC","SLIT1","EPHNA1", "ROBO1",  # shane et al.,                               
"IGSF11", "CNTN1", "CNTN5", "DSCAM", "VCAM1", "LSAMP", "PCDH9", "CDH13", "CDH5", "CD99L2", "CD99", "SLITRK1	", "EPHA5", "LRRTM3", "PMP22","DLK1", "GJD2","DD1", "ATRNL1", "GSG1L", "NYX", "PSCA", "MMEL1", "GDPD4", "LOC421174",  "EGFL6", "RELN", "KAL1","OLFML2B", "LGI1", "EDIL3", "COL3A1", "SS2", "NPVF", "PNOC", "IL9", "GAS6", "TNFSF13B",  "WIF1" , "DKK3", "CAMP", "SERPINI1","COL14A1" ,"IGFBP2", "DKK2", "CAPRIN2", "CD274", "CBLN4", #initiation
"SYP","VAMP2", "SNAP25", "SYT1","SYT2", "STX1A","STXBP1", "RIMS1", "RIMS2", "PPFIA1", "CP1X1","CASK", "CACNA1E", "CACNA1B","CACNA1A","BSN", #active zone
"HCN1", "KCNA1", "KCNC1","KCNC3", "KCND2", "KCND3","SCN1A", "SCN2A1", "SCN3A", "SCN3B", "SCN4B", "SCN8A", #action potential
"CALB2", "PVALB" # calcium buffering
), group.by  = "CELLID_Mgl" )+
RotatedAxis()

DotPlot(Comb3SNQC, features = c("GPHN", "PDK1", "MECP2", "SNCA", "EFNB3", "NLGN1",
                                "NTN1","DCC","SLIT1","EPHNA1", "ROBO1",  # shane et al.,                               
"CNTN1", "CNTN5", "DSCAM", "LSAMP", "PCDH9", "CDH13",  "CD99L2", "CD99", "SLITRK1	", "EPHA5", "LRRTM3", "PMP22","DLK1", "DD1", "ATRNL1",  "LGI1", "EDIL3", "SS2", "GAS6",  "DKK3", "SERPINI1","COL14A1" ,"IGFBP2", "DKK2", "CAPRIN2",  #initiation
"SYP","VAMP2", "SNAP25", "SYT1","SYT2", "STX1A","STXBP1", "RIMS1", "RIMS2", "PPFIA1", "CP1X1","CASK", "CACNA1E", "CACNA1B","BSN", #active zone
"HCN1", "KCNC1","KCNC3", "KCND2", "KCND3","SCN1A", "SCN2A1", "SCN3A", "SCN3B", "SCN4B", "SCN8A" #action potential 
), group.by  = "CELLID_Mgl" )+
RotatedAxis()

DotPlot(Comb3SNQC, features = c(
"SYP","VAMP2", "SNAP25", "SYT1","SYT2", "STX1A","STXBP1", "RIMS1", "RIMS2", "PPFIA1", "CP1X1","CASK", "CACNA1E", "CACNA1B","CACNA1A","BSN", #active zone
"HCN1", "KCNA1", "KCNC1","KCNC3", "KCND2", "KCND3","SCN1A", "SCN2A1", "SCN3A", "SCN3B", "SCN4B", "SCN8A"), group.by  = "CELLID_Mgl" )+
RotatedAxis()

DotPlot(Comb3SNQC, features = c(
"CNTN1", "CNTN5", "DSCAM", "LSAMP", "PCDH9", "CDH13",  "CD99L2", "CD99", "SLITRK1	", "EPHA5", "LRRTM3", "PMP22","DLK1", "DD1", "ATRNL1",  "LGI1", "EDIL3", "SS2", "GAS6",  "DKK3", "SERPINI1","COL14A1" ,"IGFBP2", "DKK2", "CAPRIN2"
), group.by  = "CELLID_Mgl" )+
RotatedAxis()


DotPlot(Comb3SNQC, features = c(
"RIMS2", "CASK", "CACNA1E", "CACNA1B","CACNA1A", #active zone
"HCN1", "KCNC3",  "KCND3","SCN1A", "SCN8A"), group.by  = "CELLID_Mgl" )+
RotatedAxis()

```

```{r}


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CNTN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CNTN1")



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CNTN5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CNTN5")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DSCAM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DSCAM")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['LSAMP',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "LSAMP")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PCDH9',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PCDH9")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CDH13',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CDH13")



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD99L2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD99L2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD99',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD99")

 
 Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CAPRIN2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CAPRIN2")
 
 Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['IGFBP2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "IGFBP2")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DKK2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DKK2")
 



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GAS6',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "GAS6")
                      
                      
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DKK3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DKK3")
 
 
 

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SERPINI1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SERPINI1")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['LGI1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "LGI1")
                      
                      
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['EDIL3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "EDIL3")
 



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DLK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DLK1")
                      
                      
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SLITRK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SLITRK1")

eph=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['EPHA5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "EPHA5")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['LRRTM3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "LRRTM3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PMP22',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PMP22")
```


```{r}

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PDK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PDK1")
```

```{r}


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
 hc= Ident_Mgl@meta.data %>%
mutate(expression = Ident_Mgl@assays$RNA@data['HCN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HCN1")



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['KCNC1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "KCNC1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['KCND2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "KCND2")

 kc=Ident_Mgl@meta.data %>%
 mutate(expression = Ident_Mgl@assays$RNA@data['KCNC3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "KCNC3")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SCN4B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SCN4B")

sc=  Ident_Mgl@meta.data %>%
mutate(expression = Ident_Mgl@assays$RNA@data['SCN8A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SCN8A")

 kcd=Ident_Mgl@meta.data %>%
 mutate(expression = Ident_Mgl@assays$RNA@data['KCND3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "KCND3")

sca=  Ident_Mgl@meta.data %>%
mutate(expression = Ident_Mgl@assays$RNA@data['SCN1A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SCN1A")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SCN3A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SCN3A")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SCN3B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SCN3B")
```

```{r}

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
cac=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CACNA1A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CACNA1A")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['BSN',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "BSN")


Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
csk=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CASK',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CASK")



cace=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CACNA1E',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CACNA1E")

cacb=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CACNA1B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CACNA1B")



Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['VAMP2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "VAMP2")



s=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SNAP25',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SNAP25")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SYT1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SYT1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SYT2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SYT2")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STX1A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STX1A")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['RIMS1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RIMS1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STXBP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STXBP1")



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PPFIA1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PPFIA1")

rim=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['RIMS2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RIMS2")


```

```{r}
pdf("pot.pdf", width = 7, height = 5)
print(hc)
print(kc)
print(sc)
print(kcd)
print(sca)
print(cac)
print(csk)
print(cace)
print(cacb)
print(rim)

dev.off()


pdf("calr.pdf", width = 7, height = 5)
print(calr)
print(ppia)
dev.off()
```



```{r}
Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
r=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ROBO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ROBO1")



d=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DCC',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DCC")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NTN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NTN1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PDPK1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PDPK1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MECP2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MeCP2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SNCA',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Synuclein")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['EFNB3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Ephrin-B3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['EFNB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Ephrin-B1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SNAP25',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SNAP-25")



g=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GPHN',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Gepherin")


sy=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SYP',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Synaptophysin")


syt=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SYT1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Synaptogamin1")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DLG4',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PSD95")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NLGN1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Neurolignin")


Ident_model<- subset(Comb3SNQC)
Idents(Ident_model)   = "Model"

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['SYP',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "Synaptophysin")



Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['GPHN',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "Gepherin")

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['SYT1',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "Synaptogamin")

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['SNCA',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "Synuclein")
```

```{r}
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CSF1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Neurolignin")
```

#exocytosis DNA9
```{r}
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SYT1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SYT1 ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SYP',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SYP")

v=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SLC18A2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd9e7"), name = "Microglia") +
  labs(title = "VMAT2")

pdf("SYN.pdf", width = 7, height = 5)
print(s)
print(r)
print(d)
print(sy)
print(syt)
print(v)
dev.off()

```


#axonal guidance A10

```{r}
#ACTB, Cofilin, Semaphorin 5A, CDC42, MELC, Actin cytoskeletal, Cofilin, non-muscle, Tubulin (in microtubules), Actin, 14-3-3 eta


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SEMA5A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SEMA5A ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CDC42',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CDC42")

act=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ACTB',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ACTB")

pdf("AX.pdf", width = 7, height = 5)
print(sema)
print(act)
print(eph)
print(np)
print(nf)
print(dp)
dev.off()
```

#axonal guidance all
```{r}


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ADCYAP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ADCYAP1 ")

sema=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SEMA3C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SEMA3C")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DCC',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DCC")

dp=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DPYSL2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DPYSL2 ")

nf=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NEFM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NEFM")



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PDE6B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RP40")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NEFL',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NEFL")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CFL1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CFL1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DCX',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DCX")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DSCAM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DSCAM")


np=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NRP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NRP1")

#ADCYAP1, SEMA3C, DCC, CRMP2, NEFM, MELC, RP40, CFL1,NEFL, DCX, DSCAM,
Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PLXND1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PLXND1")

```

```{r}
pdf("death.pdf", width = 7, height = 5)
print(casp1)
print(casp3)
print(casp8)
print(casp9)
print(inf)
print(bak)
print(bad)
print(bcl)
print(bax)
print(cyc)
print(eif)
print(fadd)
print(mlkl)
print(atf6)
print(lc3)
dev.off()
```

```{r}


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ADCYAP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ADCYAP1 ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SEMA3C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SEMA3C")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DCC',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DCC")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DPYSL2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DPYSL2 ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NEFM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NEFM")



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PDE6B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RP40")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NEFL',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NEFL")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CFL1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CFL1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DCX',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DCX")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DSCAM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DSCAM")

#ADCYAP1, SEMA3C, DCC, CRMP2, NEFM, MELC, RP40, CFL1,NEFL, DCX, DSCAM,

```
```{r}
el=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ELMO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ELMO1")

en=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MRC2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ENDO180")

st=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STAT3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STAT3")

st1=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STAT2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STAT2")

st2=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STAT1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STAT1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['IFNA1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
    facet_grid(~CELL_ID)+
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "	IFNA1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['IFNA1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
    facet_grid(~CELL_ID)+
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "	IFNA1")

hl=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-C")

hl1=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-B")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PANX1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PANX1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TGFB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TGFB1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD200',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD200")


lc=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MAP1LC3A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MAP1LC3A")


p=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SQSTM1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SQSTM1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ELMO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ELMO1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MRC2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ENDO180")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STAT3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STAT3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STAT2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STAT2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['STAT1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "STAT1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-C")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-B")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PANX1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "PANX1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TGFB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TGFB1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD200',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD200")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MAP1LC3A',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "MAP1LC3A")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SQSTM1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
      facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SQSTM1")


pdf("IM.pdf", width = 5, height = 5)
print(el+en, aspect_ratio=1)
print(lc+p)
print(st+st1)
print(st2+hl)
print(hl1+el)
dev.off()

```

#Reduced oxidative stress
```{r}

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-CO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff3333"), name = "Microglia") +
  labs(title = "COX1 Complex IV")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PTGS2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "COX2 Complex IV")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-CO3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "COX3 Complex IV")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-ND3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NADH OxRe Complex I")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-ATP6',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ATPase Complex V")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GSTP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Glutathione S-Tranferase")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MGST3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "microsomal Glutathione S-Tranferase")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PRDX1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Peroxiredoxin")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ATM")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PRDX5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Peroxiredoxin5")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SOD1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Superoxide Dismutase 1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GPX4',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Glutathione Peroxidase 4")

```
```{r}

Ident_Mgl<- subset(Comb3SNQC)
Idents(Ident_Mgl)   = "Mgl"
OX=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-CO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "COX1 Complex IV")

OX1=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PTGS2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "COX2 Complex IV")

OX2=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-CO3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "COX3 Complex IV")

OX3=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-ND3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "NADH OxRe Complex I")

OX4=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MT-ATP6',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "ATPase Complex V")

OX5=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GSTP1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "Glutathione S-Tranferase")

OX6=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['MGST3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "microsomal Glutathione S-Tranferase")

OX7=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PRDX1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "Peroxiredoxin")

OX8=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATM',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "ATM")


OX9=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PRDX5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "Peroxiredoxin5")


OX10=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SOD1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "Superoxide Dismutase 1")

OX11=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GPX4',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Microglia") +
  labs(title = "Glutathione Peroxidase 4")


OX12=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GPX4',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Conditions") +
  labs(title = "Glutathione Peroxidase 4")

OX13=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GPX6',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#ff6262"), name = "Conditions") +
  labs(title = "Glutathione Peroxidase 6")

pdf("OX.pdf", width = 5, height = 5)
print(OX+OX1, aspect_ratio=1)
print(OX2+OX3)
print(OX7+OX8)
print(OX9+OX13)
print(OX10+OX11)
print(OX4+OX5)
print(OX6+OX12)
dev.off()

figure <- ggarrange(OX, OX1, OX2,
                    labels = c("A", "B", "C"),
                    ncol = 2, nrow = 2)
figure

```
```{r}
pdf("auto.pdf", width = 7, height = 5)
print(lc3)
print(p62)
dev.off()
```




#unfolded prot response
```{r}
heat=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSP90AB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSP90AB1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['APP',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "APP")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HSP90B1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HSP90B1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CANX',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Calnexin")

eif=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['EIF2AK3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Perk")

atf6=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ATF6',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ATF6")
```

```{r}

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['RPS28',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c("#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "RPS28")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ACTB',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c("#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "beta-Actin")

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['GAPDH',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c("#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "GAPDH")

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['ACTB',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c("#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "ACTB")

Ident_model@meta.data %>%
  mutate(expression = Ident_model@assays$RNA@data['RPS28',]) %>%
  ggplot(aes(x = Model, y = expression),) +
  geom_boxplot(aes(fill = Model )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("No_Mgl", "Mgl_K7"), c("No_Mgl", "Mgl_163")),
                     method = "wilcox.test", 
                     label = "p.signif") +
  theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c("#cccccc", "#bdd7e7", "#bbb1e3"), name = "Model") +
  labs(title = "RPS28")
```

#dopamine R
```{r}


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DRD1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DRD1 ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DRD5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DRD5")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['COMT',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "COMT")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DRD2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DRD2 ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DRD3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DRD3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['DRD5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DRD5")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SLC6A3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SLC6A3")
```


#immune response
```{r}


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-C ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-B")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-C',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-C ")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['HLA-B',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "HLA-B") 



Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD63',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD63")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD63',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD63") 

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CDC42',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CDC42")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ELMO1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "ELMO1")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['IL10',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "IL10")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD200',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD200")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD200R1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD200R1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CX3CR1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CX3CR1")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CX3CL1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CX3CL1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['GP1BA',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD42")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD47',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD47")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['C3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "C3")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CSF1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CSF1")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CD34',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CD34")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['PANX1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "Pannexin")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['ANXA1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "annexin")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['IL34',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "IL34")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TGFB1',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "TGFbeta")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['S100A8',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "S100A8")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['P2RY12',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "P2RY12")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NTF3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NTF3")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['APOE',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "APOE")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CCL21',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CCL21")

ccl2=Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CCL2',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CCL2")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['CXCL12',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "CXCL12")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['APP',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "APP")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['TYROBP',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "DAP12")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['NTF3',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "NT-3")


Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['P2RX4',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "P2X4R")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['SLC12A5',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "SLC12A5")

Ident_Mgl@meta.data %>%
  mutate(expression = Ident_Mgl@assays$RNA@data['P2RX7',]) %>%
  ggplot(aes(x = Mgl, y = expression)) +
  geom_boxplot(aes(fill = Mgl )) +
  facet_grid(~CELL_ID)+
  stat_compare_means(comparisons = list(c("MOs", "pMGL-MOs")),
                     method = "wilcox.test", 
                     label = "p.signif") +
      theme(axis.text.x=element_text(angle = -90, hjust = 0))+
  scale_fill_manual(values= c( "#cccccc", "#bdd7e7"), name = "Microglia") +
  labs(title = "P2X7R")

pdf("ccl2.pdf", width =5, height=5)
print(ccl2+st)
dev.off()
```
